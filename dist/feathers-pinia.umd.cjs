(function(p,N){typeof exports=="object"&&typeof module<"u"?N(exports,require("@feathersjs/feathers"),require("pinia"),require("vue-demi"),require("@feathersjs/commons"),require("@feathersjs/adapter-commons"),require("vue"),require("@feathersjs/errors"),require("@feathersjs/rest-client")):typeof define=="function"&&define.amd?define(["exports","@feathersjs/feathers","pinia","vue-demi","@feathersjs/commons","@feathersjs/adapter-commons","vue","@feathersjs/errors","@feathersjs/rest-client"],N):(p=typeof globalThis<"u"?globalThis:p||self,N(p.feathersPinia={},p.feathers,p.pinia,p.VueDemi,p.commons,p.adapterCommons,p.Vue,p.errors,p.restClient))})(this,function(p,N,Z,l,D,je,ce,pr,hr){"use strict";var Vs=Object.defineProperty;var Us=(p,N,Z)=>N in p?Vs(p,N,{enumerable:!0,configurable:!0,writable:!0,value:Z}):p[N]=Z;var tt=(p,N,Z)=>(Us(p,typeof N!="symbol"?N+"":N,Z),Z);var he=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ye(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var yr=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var n,s,i;if(Array.isArray(t)){if(n=t.length,n!=r.length)return!1;for(s=n;s--!==0;)if(!e(t[s],r[s]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(i=Object.keys(t),n=i.length,n!==Object.keys(r).length)return!1;for(s=n;s--!==0;)if(!Object.prototype.hasOwnProperty.call(r,i[s]))return!1;for(s=n;s--!==0;){var o=i[s];if(!e(t[o],r[o]))return!1}return!0}return t!==t&&r!==r};const rt=ye(yr);var gr=Function.prototype.toString,ke=Object.create,vr=Object.prototype.toString,mr=function(){function e(){this._keys=[],this._values=[]}return e.prototype.has=function(t){return!!~this._keys.indexOf(t)},e.prototype.get=function(t){return this._values[this._keys.indexOf(t)]},e.prototype.set=function(t,r){this._keys.push(t),this._values.push(r)},e}();function Sr(){return new mr}function Ir(){return new WeakMap}var Or=typeof WeakMap<"u"?Ir:Sr;function Ee(e){if(!e)return ke(null);var t=e.constructor;if(t===Object)return e===Object.prototype?{}:ke(e);if(~gr.call(t).indexOf("[native code]"))try{return new t}catch{}return ke(e)}function br(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}function wr(e){return e.flags}var _r=/test/g.flags==="g"?wr:br;function nt(e){var t=vr.call(e);return t.substring(8,t.length-1)}function $r(e){return e[Symbol.toStringTag]||nt(e)}var Pr=typeof Symbol<"u"?$r:nt,jr=Object.defineProperty,kr=Object.getOwnPropertyDescriptor,st=Object.getOwnPropertyNames,Ae=Object.getOwnPropertySymbols,ot=Object.prototype,it=ot.hasOwnProperty,Er=ot.propertyIsEnumerable,ut=typeof Ae=="function";function Ar(e){return st(e).concat(Ae(e))}var qr=ut?Ar:st;function ge(e,t,r){for(var n=qr(e),s=0,i=n.length,o=void 0,u=void 0;s<i;++s)if(o=n[s],!(o==="callee"||o==="caller")){if(u=kr(e,o),!u){t[o]=r.copier(e[o],r);continue}!u.get&&!u.set&&(u.value=r.copier(u.value,r));try{jr(t,o,u)}catch{t[o]=u.value}}return t}function Fr(e,t){var r=new t.Constructor;t.cache.set(e,r);for(var n=0,s=e.length;n<s;++n)r[n]=t.copier(e[n],t);return r}function Cr(e,t){var r=new t.Constructor;return t.cache.set(e,r),ge(e,r,t)}function ct(e,t){return e.slice(0)}function Tr(e,t){return e.slice(0,e.size,e.type)}function Lr(e,t){return new t.Constructor(ct(e.buffer))}function Br(e,t){return new t.Constructor(e.getTime())}function at(e,t){var r=new t.Constructor;return t.cache.set(e,r),e.forEach(function(n,s){r.set(s,t.copier(n,t))}),r}function Nr(e,t){return ge(e,at(e,t),t)}function Rr(e,t){var r=Ee(t.prototype);t.cache.set(e,r);for(var n in e)it.call(e,n)&&(r[n]=t.copier(e[n],t));return r}function Mr(e,t){var r=Ee(t.prototype);t.cache.set(e,r);for(var n in e)it.call(e,n)&&(r[n]=t.copier(e[n],t));for(var s=Ae(e),i=0,o=s.length,u=void 0;i<o;++i)u=s[i],Er.call(e,u)&&(r[u]=t.copier(e[u],t));return r}var Qr=ut?Mr:Rr;function Wr(e,t){var r=Ee(t.prototype);return t.cache.set(e,r),ge(e,r,t)}function qe(e,t){return new t.Constructor(e.valueOf())}function Gr(e,t){var r=new t.Constructor(e.source,_r(e));return r.lastIndex=e.lastIndex,r}function ve(e,t){return e}function lt(e,t){var r=new t.Constructor;return t.cache.set(e,r),e.forEach(function(n){r.add(t.copier(n,t))}),r}function Vr(e,t){return ge(e,lt(e,t),t)}var Ur=Array.isArray,Fe=Object.assign,Jr=Object.getPrototypeOf||function(e){return e.__proto__},ft={array:Fr,arrayBuffer:ct,blob:Tr,dataView:Lr,date:Br,error:ve,map:at,object:Qr,regExp:Gr,set:lt},zr=Fe({},ft,{array:Cr,map:Nr,object:Wr,set:Vr});function Kr(e){return{Arguments:e.object,Array:e.array,ArrayBuffer:e.arrayBuffer,Blob:e.blob,Boolean:qe,DataView:e.dataView,Date:e.date,Error:e.error,Float32Array:e.arrayBuffer,Float64Array:e.arrayBuffer,Int8Array:e.arrayBuffer,Int16Array:e.arrayBuffer,Int32Array:e.arrayBuffer,Map:e.map,Number:qe,Object:e.object,Promise:ve,RegExp:e.regExp,Set:e.set,String:qe,WeakMap:ve,WeakSet:ve,Uint8Array:e.arrayBuffer,Uint8ClampedArray:e.arrayBuffer,Uint16Array:e.arrayBuffer,Uint32Array:e.arrayBuffer,Uint64Array:e.arrayBuffer}}function dt(e){var t=Fe({},ft,e),r=Kr(t),n=r.Array,s=r.Object;function i(o,u){if(u.prototype=u.Constructor=void 0,!o||typeof o!="object")return o;if(u.cache.has(o))return u.cache.get(o);if(u.prototype=Jr(o),u.Constructor=u.prototype&&u.prototype.constructor,!u.Constructor||u.Constructor===Object)return s(o,u);if(Ur(o))return n(o,u);var c=r[Pr(o)];return c?c(o,u):typeof o.then=="function"?o:s(o,u)}return function(u){return i(u,{Constructor:void 0,cache:Or(),copier:i,prototype:void 0})}}function Hr(e){return dt(Fe({},zr,e))}var pt=Hr({}),x=dt({});function ee(e,t){return Object.keys(t).forEach(r=>{Object.defineProperty(e,r,{enumerable:!1,configurable:!0,value:t[r]})}),e}function Ce(e,t){return Object.keys(t).forEach(r=>{Object.defineProperty(e,r,{enumerable:!1,configurable:!0,get:t[r]})}),e}function Yr(e,t){return Object.keys(t).forEach(r=>{Object.defineProperty(e,r,{enumerable:!1,configurable:!0,set:t[r]})}),e}function te(e,t){return t&&(Array.isArray(t)?t.map(r=>e.new(r)):t&&Array.isArray(t.data)?(t.data=t.data.map(r=>e.new(r)),t):e.new(t))}function ht(e){return typeof Symbol<"u"?Symbol.for(e):e}const yt=ht("@feathersjs/service");function me({queryInfo:e,service:t,store:r,qid:n}){const i=r.pagination[n.value][e.queryId];if(!i)return null;const{total:o}=i,u=i[e.pageId];if(!u)return null;const{ids:c,queriedAt:a,ssr:f}=u,h=c.map(I=>r.itemsById[I]).filter(I=>I),w=te(t,h);return{...e,ids:c,items:w,total:o,queriedAt:a,queryState:i,ssr:f}||null}function G(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function z(e){const t=Array.isArray(e);return{items:t?e:[e],isArray:t}}function Se(e,t){if(!t)return e;const n=(typeof t=="string"?[t]:Array.isArray(t)?t:Object.keys(t||e)).map(s=>s.toString().split(".")[0]);return D._.pick(e,...n)}function Te(e,t,r){const n=Se(e,r),s=Se(t,r);return typeof r!="string"&&!Array.isArray(r)&&Object.assign(s,r),rt(n,s)?{}:Object.keys(s).reduce((u,c)=>(rt(e[c],s[c])||(u[c]=s[c]),u),{})}function gt(e,t,r="__tempId"){const{items:n,isArray:s}=z(e),{items:i}=z(t);return i.forEach((o,u)=>{const c=n[u][r];c&&ee(o,{[r]:c})}),s?i:i[0]}function Le(e){return typeof e=="object"&&e!=null?e.toString():e}function ae(e,t){if(e){if(t&&e[t]!==void 0)return Le(e[t]);if(e.id!==void 0)return Le(e.id);if(e._id!==void 0)return Le(e._id)}}function K(e){return e?x(l.unref(e)):{}}function re(e){return new Promise(t=>setTimeout(t,e))}function vt(){const e=l.ref(0);return{count:e,add:()=>{e.value=e.value+1},sub:()=>{e.value=e.value===0?0:e.value-1}}}const Xr=e=>e!==null&&typeof e=="object",Zr=Array.isArray;function mt(e){return e!==null&&!l.isRef(e)&&typeof e=="object"?Q(e):l.unref(e)}const xr=e=>e.map(mt);function Dr(e){const t={};return Object.keys(e).forEach(r=>{t[r]=mt(e[r])}),t}function Q(e){const t=l.isRef(e)?l.unref(e):e;return Xr(t)?Zr(t)?xr(t):Dr(t):t}function en(e,t){const r=Object.keys(t),n=D._.omit(e,...r);return Object.assign(t,x(n))}function St(e,t){if(!e)return e;const r=n=>t.createInStore(n);return Array.isArray(e)?e.map(r):r(e)}function Be(e,t,r){const n={enumerable:!1};typeof r=="function"?n.get=function(){return r(this)}:n.value=r,Object.defineProperty(e,t,n)}function It(e,t){Object.keys(t).forEach(r=>Be(e,r,t[r]))}const tn=["update","hooks","setMaxListeners","getMaxListeners","addListener","prependListener","once","prependOnceListener","removeListener","off","removeAllListeners","listeners","rawListeners","emit","eventNames","listenerCount","on"];function Ot(e){return typeof e=="function"?e():l.unref(e)}typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const bt=()=>{};function rn(e,t){function r(...n){return new Promise((s,i)=>{Promise.resolve(e(()=>t.apply(this,n),{fn:t,thisArg:this,args:n})).then(s).catch(i)})}return r}function nn(e,t={}){let r,n,s=bt;const i=u=>{clearTimeout(u),s(),s=bt};return u=>{const c=Ot(e),a=Ot(t.maxWait);return r&&i(r),c<=0||a!==void 0&&a<=0?(n&&(i(n),n=null),Promise.resolve(u())):new Promise((f,h)=>{s=t.rejectOnCancel?h:f,a&&!n&&(n=setTimeout(()=>{r&&i(r),n=null,f(u())},a)),r=setTimeout(()=>{n&&i(n),n=null,f(u())},c)})}}function sn(e,t=200,r={}){return rn(nn(t,r),e)}var on=function(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var r=typeof t.cycles=="boolean"?t.cycles:!1,n=t.cmp&&function(i){return function(o){return function(u,c){var a={key:u,value:o[u]},f={key:c,value:o[c]};return i(a,f)}}}(t.cmp),s=[];return function i(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var u,c;if(Array.isArray(o)){for(c="[",u=0;u<o.length;u++)u&&(c+=","),c+=i(o[u])||"null";return c+"]"}if(o===null)return"null";if(s.indexOf(o)!==-1){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=s.push(o)-1,f=Object.keys(o).sort(n&&n(o));for(c="",u=0;u<f.length;u++){var h=f[u],w=i(o[h]);w&&(c&&(c+=","),c+=JSON.stringify(h)+":"+w)}return s.splice(a,1),"{"+c+"}"}}(e)};const Ie=ye(on);function un(e,t){const{queryId:r,pageId:n}=t,s=e[r],i=s&&s[n];return i&&i.ids||[]}function cn(e,t,r){const n=r.qid||"default",s=e.pagination[n]||{},i=e.getQueryInfo(r);return un(s,i).map(c=>t.getFromStore(c).value).filter(c=>c)}function an(e,t){const{queryId:r}=t,n=e[r]||{};return[...new Set(Object.keys(n).filter(i=>!["total","queryParams"].includes(i)).reduce((i,o)=>{var u;return i=i.concat(((u=n==null?void 0:n[o])==null?void 0:u.ids)||[]),i},[]))]||[]}function ln(e,t,r){const n=r.qid||"default",s=e.pagination[n]||{},i=e.getQueryInfo(r);return an(s,i).map(c=>t.getFromStore(c).value).filter(c=>c)}function fn(e){const{limit:t,skip:r,total:n,request:s}=e,i=l.computed(()=>n.value?Math.ceil(n.value/t.value):1),o=l.computed({set(g){g<1?g=1:g>i.value&&(g=i.value);const _=t.value*Math.floor(g-1);r.value=_},get(){const g=r.value||0;return i.value===0?0:Math.floor(g/t.value+1)}}),u=l.computed(()=>o.value-1>0),c=l.computed(()=>o.value<i.value),a=async()=>{s!=null&&s.value&&await s.value};return{pageCount:i,currentPage:o,canPrev:u,canNext:c,toStart:async()=>(o.value=1,await re(0),a()),toEnd:async()=>(o.value=i.value,await re(0),a()),toPage:async g=>(o.value=g,await re(0),a()),next:async()=>(o.value++,await re(0),a()),prev:async()=>(o.value--,await re(0),a())}}function wt(e,t={},r){var ar,lr,fr,dr;const{pagination:n,debounce:s=100,immediate:i=!0,watch:o=!0,paginateOn:u="client"}=t,{service:c}=r,{store:a}=c,f=l.computed(()=>{var k;return((k=e.value)==null?void 0:k.qid)||"default"}),h=(n==null?void 0:n.limit)||l.ref(((lr=(ar=e.value)==null?void 0:ar.query)==null?void 0:lr.$limit)||a.defaultLimit),w=(n==null?void 0:n.skip)||l.ref(((dr=(fr=e.value)==null?void 0:fr.query)==null?void 0:dr.$skip)||0),d=l.computed(()=>{var T;const k=Q(((T=e.value)==null?void 0:T.query)||{});return{...e.value,query:{...k,$limit:h.value,$skip:w.value}}}),I=l.computed(()=>{var ue;const k=Q(((ue=e.value)==null?void 0:ue.query)||{}),T=D._.omit(k,"$limit","$skip");return{...e.value,query:T}}),g=l.ref(!1),_=l.ref(!1),b=l.ref(!1),S=l.ref(null),O=()=>S.value=null,A=l.ref(Q(e.value||{}));function $(){Ie(A.value)!==Ie(d.value)&&(A.value=d.value)}let v=()=>!0;const y=k=>{v=k},m=l.computed(()=>{if(!a.pagination[f.value])return null;const T=a.getQueryInfo(A.value);return me({queryInfo:T,service:c,store:a,qid:f})}),j=l.computed(()=>{if(!a.pagination[f.value])return null;const T=a.getQueryInfo(d.value);return me({queryInfo:T,service:c,store:a,qid:f})}),P=l.computed(()=>(g.value?m.value:j.value)==null&&u!=="client"?[]:u==="server"?ln(a,c,A.value):c.findInStore(Q(I.value)).data.filter(M=>M)),C=l.computed(()=>{const k=g.value?m.value:j.value;if(k==null)return[];const T=P.value,M=k.items.find(et=>et),ue=T.findIndex(et=>et[a.idField]===M[a.idField]),Pe=Math.min(ue,w.value);return T.slice(0,Pe)}),F=l.computed(()=>{const k=C.value,T=w.value+(k.length-w.value);return{...d.value,query:{...d.value.query,$limit:h.value,$skip:T}}}),R=l.computed(()=>u==="server"?cn(a,c,A.value):u==="hybrid"?c.findInStore(Q(F)).data.filter(T=>T):c.findInStore(Q(d)).data.filter(T=>T)),q=l.ref([]),E=l.computed(()=>q.value[q.value.length-1]||null),L=l.computed(()=>q.value[q.value.length-2]||null),Y=l.ref(0),ie=l.ref(null);function de(){var k;(k=j.value)!=null&&k.ssr||(_.value||(_.value=!0),O(),g.value||(g.value=!0),b.value&&(b.value=!1))}async function xe(k){const T=l.unref(k??(u==="client"?I.value:d.value));if(!v())return Promise.resolve({data:[]});de(),Y.value++;try{const M=await c.find(T);if(M.total){const ue=a.getQueryInfo(d.value),Pe=me({queryInfo:ue,service:c,store:a,qid:f});Pe&&q.value.push(Pe),q.value.length>2&&q.value.shift()}return b.value=!0,M}catch(M){throw S.value=M,M}finally{g.value=!1}}const De=sn(xe,s),X=async k=>{e.value!==null&&(j.value&&$(),v()&&de(),ie.value=De(k),await ie.value,$())},J=l.computed(()=>{if(["server","hybrid"].includes(u)){const k=j.value||m.value;return(k==null?void 0:k.total)||0}else return c.countInStore(I.value).value}),pe=fn({limit:h,skip:w,total:J,request:ie}),{pageCount:$e,currentPage:Ls,canPrev:Bs,canNext:Ns,toStart:Rs,toEnd:Ms,toPage:Qs,next:Ws,prev:Gs}=pe,cr=l.computed(()=>(setTimeout(()=>{l.ref(J.value)},0),a.isSsr));return cr.value?i&&X():["server","hybrid"].includes(u)&&o&&(l.watch(d,()=>{X()},{immediate:!1,flush:"sync"}),i&&X()),u==="server"&&c.on&&(c.on("created",()=>{X()}),c.on("patched",()=>{X()}),c.on("removed",()=>{X()})),l.reactive({paramsWithPagination:d,isSsr:cr,qid:f,data:R,allLocalData:P,total:J,limit:h,skip:w,currentQuery:j,cachedQuery:m,latestQuery:E,previousQuery:L,find:X,request:ie,requestCount:Y,queryWhen:y,isPending:l.computed(()=>g.value),haveBeenRequested:l.computed(()=>_.value),haveLoaded:l.computed(()=>b.value),error:l.computed(()=>S.value),clearError:O,pageCount:$e,currentPage:Ls,canPrev:Bs,canNext:Ns,next:Ws,prev:Gs,toStart:Rs,toEnd:Ms,toPage:Qs})}function _t(e,t=l.ref({}),r){const{service:n}=r,s=l.isRef(e)?e:l.ref(e),i=l.isRef(t)?t:l.ref(t),{immediate:o=!0,watch:u=!0}=i.value,c=l.computed(()=>n.store.isSsr),a=l.ref(!1),f=l.ref(!1),h=l.ref(null),w=()=>h.value=null,d=l.ref([]),I=l.computed(()=>d.value.length&&d.value[d.value.length-1]),g=l.computed(()=>a.value&&I.value!=null?n.store.getFromStore(I.value,i).value:n.store.getFromStore(s.value,i).value),_=n.store.getFromStore,b=l.computed(()=>!!g.value);let S=()=>!0;const O=m=>{S=m},A=l.ref(0),$=l.ref(null);async function v(){const m=l.unref(s),j=l.unref(i);if(S()){if(m==null)return null;A.value++,f.value=!0,a.value=!0,h.value=null;try{const P=await n.get(m,j);return P&&m&&d.value.push(m),P}catch(P){h.value=P}finally{a.value=!1}}}async function y(){return $.value=v(),await $.value}return c.value?o&&y():u&&l.watch(s,async()=>{await y()},{immediate:o,flush:"pre"}),l.reactive({params:i,isSsr:c,data:g,ids:d,getFromStore:_,get:y,request:$,requestCount:A,queryWhen:O,isPending:l.computed(()=>a.value),hasBeenRequested:l.computed(()=>f.value),hasLoaded:l.computed(()=>b.value),error:l.computed(()=>h.value),clearError:w})}class $t{constructor(t,r){tt(this,"store");tt(this,"servicePath","");this.service=t,this.options=r,this.store=r.store,this.servicePath=r.servicePath,this.options=r,this.options.methods=["create","patch","remove"],this.options.events=["created","patched","removed"];const n=Object.getOwnPropertyNames(Object.getPrototypeOf(this)).concat(tn);for(const s in t)if(typeof t[s]=="function"&&!n.includes(s)){const i=this;i[s]=t[s].bind(t),this.options.methods.push(s)}Object.defineProperty(this,yt,{value:this.options})}new(t={}){const r=this.store.new(t);return l.reactive(r)}async find(t){const r=K(t);return await this.service.find(r)}async findOne(t){const r=K(t);r.query=r.query||{},r.query.$limit=1;const n=await this.service.find(r);return(n.data||n)[0]||null}async count(t){const r=K(t);return r.query=r.query||{},r.query.$limit=0,await this.service.find(r)}async get(t,r){const n=K(r);return await this.service.get(t,n)}async create(t,r){const n=K(r);return await this.service.create(t,n)}async patch(t,r,n){const s=K(n);return await this.service.patch(t,r,s)}async remove(t,r){const n=K(r);return await this.service.remove(l.unref(t),n)}findInStore(t){const r=this.store.findInStore(t);return l.reactive({...r,data:l.computed(()=>r.data.map(n=>te(this,n)))})}findOneInStore(t){return this.store.findOneInStore(t)}countInStore(t){return this.store.countInStore(t)}getFromStore(t,r){return this.store.getFromStore(t,r)}createInStore(t){return this.store.createInStore(t)}patchInStore(t,r={},n={}){return this.store.patchInStore(t,r,n)}removeFromStore(t,r){var s;const n=t!=null?this.getFromStore(t).value:null;if(n)return this.store.removeFromStore(n);if(t==null&&((s=l.unref(r))!=null&&s.query))return this.store.removeByQuery(r)}useFind(t,r){const n=l.isRef(t)?t:l.ref(t);return wt(n,r,{service:this})}useGet(t,r=l.ref({})){const n=l.isRef(t)?t:l.ref(t),s=l.isRef(r)?r:l.ref(r);return _t(n,s,{service:this})}useGetOnce(t,r={}){const n=l.isRef(r)?r:l.ref(r);Object.assign(n.value,{immediate:!1});const s=this.useGet(t,n);return s.queryWhen(()=>!s.data),s.get(),s}on(t,r){if(this.service.on)return this.service.on(t,r)}emit(t,...r){return this.service.emit?this.service.emit(t,...r):!1}removeListener(t,r){if(this.service.removeListener)return this.service.removeListener(t,r)}}var Pt={exports:{}};/*!
 * isomorphic-mongo-objectid - v@version@
 * Pure JavaScript implementation of mongodb ObjectId for the browser and server
 * https://github.com/john-doherty/isomorphic-mongo-objectid
 * @author John Doherty <www.johndoherty.info>
 * @license MIT
 */(function(e){(function(){var t=0,r=Math.floor(Math.random()*32767),n=Math.floor(Math.random()*16777216);if(typeof window<"u"){var s=window.localStorage,i=parseInt(s.mongoMachineId,10);i>=0&&i<=16777215&&(n=Math.floor(s.mongoMachineId)),s.mongoMachineId=n}function o(){var u=arguments;if(!(this instanceof o))return u.length>0?new o(u[0],u[1],u[2],u[3]):new o;typeof u[0]=="object"?(this.timestamp=u[0].timestamp,this.machine=u[0].machine,this.pid=u[0].pid,this.increment=u[0].increment):typeof u[0]=="string"&&u[0].length===24?(this.timestamp=+("0x"+u[0].substr(0,8)),this.machine=+("0x"+u[0].substr(8,6)),this.pid=+("0x"+u[0].substr(14,4)),this.increment=+("0x"+u[0].substr(18,6))):u.length===4&&u[0]!==null?(this.timestamp=u[0],this.machine=u[1],this.pid=u[2],this.increment=u[3]):(this.timestamp=Math.floor(new Date().valueOf()/1e3),this.machine=n,this.pid=r,this.increment=t++,t>16777215&&(t=0))}o.prototype.getDate=function(){return new Date(this.timestamp*1e3)},o.prototype.toArray=function(){var u=this.toString(),c=[],a;for(a=0;a<12;a++)c[a]=parseInt(u.slice(a*2,a*2+2),16);return c},o.prototype.toString=function(){var u=this.timestamp.toString(16),c=this.machine.toString(16),a=this.pid.toString(16),f=this.increment.toString(16);return["00000000".substr(0,8-u.length)+u,"000000".substr(0,6-c.length)+c,"0000".substr(0,4-a.length)+a,"000000".substr(0,6-f.length)+f].join("")},e.exports=o})()})(Pt);var dn=Pt.exports,pn=dn;const hn=ye(pn);function Ne(e,t){if(e.__isStoreInstance)return e;const{idField:r,clonesById:n,clone:s,commit:i,reset:o,createInStore:u,removeFromStore:c}=t,a=e.__isClone||!1;return Object.defineProperty(e,"__isTemp",{configurable:!0,enumerable:!1,get(){return this[this.__idField]==null}}),ee(e,{__isStoreInstance:!0,__isClone:a,__idField:r,__tempId:e[r]==null&&e.__tempId==null?new hn().toString():e.__tempId||void 0,hasClone(){const h=this[this.__idField]||this.__tempId;return n.value[h]||null},clone(h={},w={}){return s(this,h,w)},commit(h={}){return i(this,h)},reset(h={}){return o(this,h)},createInStore(){return u(this)},removeFromStore(){return c(this)}})}/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Re=function(e,t){return Re=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=n[s])},Re(e,t)};function B(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Re(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Me=function(e){var t="[object "+e+"]";return function(r){return yn(r)===t}},yn=function(e){return Object.prototype.toString.call(e)},ne=function(e){return e instanceof Date?e.getTime():se(e)?e.map(ne):e&&typeof e.toJSON=="function"?e.toJSON():e},gn=function(e){return e??null},se=Me("Array"),vn=Me("Object"),mn=Me("Function"),Sn=function(e){return e&&(e.constructor===Object||e.constructor===Array||e.constructor.toString()==="function Object() { [native code] }"||e.constructor.toString()==="function Array() { [native code] }")&&!e.toJSON},Qe=function(e,t){if(e==null&&e==t||e===t)return!0;if(Object.prototype.toString.call(e)!==Object.prototype.toString.call(t))return!1;if(se(e)){if(e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(!Qe(e[r],t[r]))return!1;return!0}else if(vn(e)){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var s in e)if(!Qe(e[s],t[s]))return!1;return!0}return!1},We=function(e,t,r,n,s,i){var o=t[n];if(se(e)&&isNaN(Number(o))){for(var u=0,c=e.length;u<c;u++)if(!We(e[u],t,r,n,u,e))return!1}return n===t.length||e==null?r(e,s,i,n===0):We(e[o],t,r,n+1,o,e)},W=function(){function e(t,r,n,s){this.params=t,this.owneryQuery=r,this.options=n,this.name=s,this.init()}return e.prototype.init=function(){},e.prototype.reset=function(){this.done=!1,this.keep=!1},e}(),Ge=function(e){B(t,e);function t(r,n,s,i){var o=e.call(this,r,n,s)||this;return o.children=i,o}return t.prototype.reset=function(){this.keep=!1,this.done=!1;for(var r=0,n=this.children.length;r<n;r++)this.children[r].reset()},t.prototype.childrenNext=function(r,n,s,i){for(var o=!0,u=!0,c=0,a=this.children.length;c<a;c++){var f=this.children[c];if(f.done||f.next(r,n,s,i),f.keep||(u=!1),f.done){if(!f.keep)break}else o=!1}this.done=o,this.keep=u},t}(W),jt=function(e){B(t,e);function t(r,n,s,i,o){var u=e.call(this,r,n,s,i)||this;return u.name=o,u}return t}(Ge),In=function(e){B(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.propop=!0,r}return t.prototype.next=function(r,n,s,i){this.childrenNext(r,n,s,i)},t}(Ge),Ve=function(e){B(t,e);function t(r,n,s,i,o){var u=e.call(this,n,s,i,o)||this;return u.keyPath=r,u.propop=!0,u._nextNestedValue=function(c,a,f,h){return u.childrenNext(c,a,f,h),!u.done},u}return t.prototype.next=function(r,n,s){We(r,this.keyPath,this._nextNestedValue,0,n,s)},t}(Ge),Ue=function(e,t){if(e instanceof Function)return e;if(e instanceof RegExp)return function(n){var s=typeof n=="string"&&e.test(n);return e.lastIndex=0,s};var r=ne(e);return function(n){return t(r,ne(n))}},V=function(e){B(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.propop=!0,r}return t.prototype.init=function(){this._test=Ue(this.params,this.options.compare)},t.prototype.next=function(r,n,s){(!Array.isArray(s)||s.hasOwnProperty(n))&&this._test(r,n,s)&&(this.done=!0,this.keep=!0)},t}(W),Oe=function(e,t,r){return new V(e,t,r)},On=function(e){return function(t,r,n,s){return e(t,r,n,s)}},be=function(e){return On(function(t,r,n,s){var i=typeof ne(t),o=e(t);return new V(function(u){var c=gn(u);return typeof ne(c)===i&&o(c)},r,n,s)})},bn=function(e,t,r,n){var s=n.operations[e];return s||kt(e),s(t,r,n,e)},kt=function(e){throw new Error("Unsupported operation: "+e)},Et=function(e,t){for(var r in e)if(t.operations.hasOwnProperty(r)||r.charAt(0)==="$")return!0;return!1},wn=function(e,t,r,n,s){if(Et(t,s)){var i=At(t,r,s),o=i[0],u=i[1];if(u.length)throw new Error("Property queries must contain only operations, or exact objects.");return new Ve(e,t,n,s,o)}return new Ve(e,t,n,s,[new V(t,n,s)])},oe=function(e,t,r){t===void 0&&(t=null);var n=r===void 0?{}:r,s=n.compare,i=n.operations,o={compare:s||Qe,operations:Object.assign({},i||{})},u=At(e,null,o),c=u[0],a=u[1],f=[];return c.length&&f.push(new Ve([],e,t,o,c)),f.push.apply(f,a),f.length===1?f[0]:new In(e,t,o,f)},At=function(e,t,r){var n=[],s=[];if(!Sn(e))return n.push(new V(e,e,r)),[n,s];for(var i in e)if(r.operations.hasOwnProperty(i)){var o=bn(i,e[i],e,r);if(o&&!o.propop&&t&&!r.operations[t])throw new Error("Malformed query. "+i+" cannot be matched against property.");o!=null&&n.push(o)}else i.charAt(0)==="$"?kt(i):s.push(wn(i.split("."),e[i],i,e,r));return[n,s]},_n=function(e){return function(t,r,n){return e.reset(),e.next(t,r,n),e.keep}},$n=function(e){B(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.propop=!0,r}return t.prototype.init=function(){this._test=Ue(this.params,this.options.compare)},t.prototype.reset=function(){e.prototype.reset.call(this),this.keep=!0},t.prototype.next=function(r){this._test(r)&&(this.done=!0,this.keep=!1)},t}(W),Pn=function(e){B(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.propop=!0,r}return t.prototype.init=function(){if(!this.params||typeof this.params!="object")throw new Error("Malformed query. $elemMatch must by an object.");this._queryOperation=oe(this.params,this.owneryQuery,this.options)},t.prototype.reset=function(){e.prototype.reset.call(this),this._queryOperation.reset()},t.prototype.next=function(r){if(se(r)){for(var n=0,s=r.length;n<s;n++){this._queryOperation.reset();var i=r[n];this._queryOperation.next(i,n,r,!1),this.keep=this.keep||this._queryOperation.keep}this.done=!0}else this.done=!1,this.keep=!1},t}(W),jn=function(e){B(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.propop=!0,r}return t.prototype.init=function(){this._queryOperation=oe(this.params,this.owneryQuery,this.options)},t.prototype.reset=function(){e.prototype.reset.call(this),this._queryOperation.reset()},t.prototype.next=function(r,n,s,i){this._queryOperation.next(r,n,s,i),this.done=this._queryOperation.done,this.keep=!this._queryOperation.keep},t}(W),qt=function(e){B(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.propop=!0,r}return t.prototype.init=function(){},t.prototype.next=function(r){se(r)&&r.length===this.params&&(this.done=!0,this.keep=!0)},t}(W),Ft=function(e){if(e.length===0)throw new Error("$and/$or/$nor must be a nonempty array")},Ct=function(e){B(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.propop=!1,r}return t.prototype.init=function(){var r=this;Ft(this.params),this._ops=this.params.map(function(n){return oe(n,null,r.options)})},t.prototype.reset=function(){this.done=!1,this.keep=!1;for(var r=0,n=this._ops.length;r<n;r++)this._ops[r].reset()},t.prototype.next=function(r,n,s){for(var i=!1,o=!1,u=0,c=this._ops.length;u<c;u++){var a=this._ops[u];if(a.next(r,n,s),a.keep){i=!0,o=a.keep;break}}this.keep=o,this.done=i},t}(W),kn=function(e){B(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.propop=!1,r}return t.prototype.next=function(r,n,s){e.prototype.next.call(this,r,n,s),this.keep=!this.keep},t}(Ct),Tt=function(e){B(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.propop=!0,r}return t.prototype.init=function(){var r=this;this._testers=this.params.map(function(n){if(Et(n,r.options))throw new Error("cannot nest $ under "+r.name.toLowerCase());return Ue(n,r.options.compare)})},t.prototype.next=function(r,n,s){for(var i=!1,o=!1,u=0,c=this._testers.length;u<c;u++){var a=this._testers[u];if(a(r)){i=!0,o=!0;break}}this.keep=o,this.done=i},t}(W),En=function(e){B(t,e);function t(r,n,s,i){var o=e.call(this,r,n,s,i)||this;return o.propop=!0,o._in=new Tt(r,n,s,i),o}return t.prototype.next=function(r,n,s,i){this._in.next(r,n,s),se(s)&&!i?this._in.keep?(this.keep=!1,this.done=!0):n==s.length-1&&(this.keep=!0,this.done=!0):(this.keep=!this._in.keep,this.done=!0)},t.prototype.reset=function(){e.prototype.reset.call(this),this._in.reset()},t}(W),An=function(e){B(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.propop=!0,r}return t.prototype.next=function(r,n,s){s.hasOwnProperty(n)===this.params&&(this.done=!0,this.keep=!0)},t}(W),qn=function(e){B(t,e);function t(r,n,s,i){var o=e.call(this,r,n,s,r.map(function(u){return oe(u,n,s)}),i)||this;return o.propop=!1,Ft(r),o}return t.prototype.next=function(r,n,s,i){this.childrenNext(r,n,s,i)},t}(jt),Fn=function(e){B(t,e);function t(r,n,s,i){var o=e.call(this,r,n,s,r.map(function(u){return oe(u,n,s)}),i)||this;return o.propop=!0,o}return t.prototype.next=function(r,n,s,i){this.childrenNext(r,n,s,i)},t}(jt),Cn=function(e,t,r){return new V(e,t,r)},Tn=function(e,t,r,n){return new $n(e,t,r,n)},Ln=function(e,t,r,n){return new Ct(e,t,r,n)},Bn=function(e,t,r,n){return new kn(e,t,r,n)},Nn=function(e,t,r,n){return new Pn(e,t,r,n)},Rn=function(e,t,r,n){return new En(e,t,r,n)},Mn=function(e,t,r,n){return new Tt(e,t,r,n)},Qn=be(function(e){return function(t){return t!=null&&t<e}}),Wn=be(function(e){return function(t){return t===e||t<=e}}),Gn=be(function(e){return function(t){return t!=null&&t>e}}),Vn=be(function(e){return function(t){return t===e||t>=e}}),Un=function(e,t,r){var n=e[0],s=e[1];return new V(function(i){return ne(i)%n===s},t,r)},Jn=function(e,t,r,n){return new An(e,t,r,n)},zn=function(e,t,r){return new V(new RegExp(e,t.$options),t,r)},Kn=function(e,t,r,n){return new jn(e,t,r,n)},Lt={number:function(e){return typeof e=="number"},string:function(e){return typeof e=="string"},bool:function(e){return typeof e=="boolean"},array:function(e){return Array.isArray(e)},null:function(e){return e===null},timestamp:function(e){return e instanceof Date}},Hn=function(e,t,r){return new V(function(n){if(typeof e=="string"){if(!Lt[e])throw new Error("Type alias does not exist");return Lt[e](n)}return n!=null?n instanceof e||n.constructor===e:!1},t,r)},Yn=function(e,t,r,n){return new qn(e,t,r,n)},Xn=function(e,t,r,n){return new Fn(e,t,r,n)},Zn=function(e,t,r){return new qt(e,t,r,"$size")},xn=function(){return null},Dn=function(e,t,r){var n;if(mn(e))n=e;else if(!process.env.CSP_ENABLED)n=new Function("obj","return "+e);else throw new Error('In CSP mode, sift does not support strings in "$where" condition');return new V(function(s){return n.bind(s)(s)},t,r)},es=Object.freeze({__proto__:null,$Size:qt,$eq:Cn,$ne:Tn,$or:Ln,$nor:Bn,$elemMatch:Nn,$nin:Rn,$in:Mn,$lt:Qn,$lte:Wn,$gt:Gn,$gte:Vn,$mod:Un,$exists:Jn,$regex:zn,$not:Kn,$type:Hn,$and:Yn,$all:Xn,$size:Zn,$options:xn,$where:Dn}),ts=function(e,t,r){var n=r===void 0?{}:r,s=n.compare,i=n.operations;return oe(e,t,{compare:s,operations:Object.assign({},es,i||{})})},rs=function(e,t){t===void 0&&(t={});var r=ts(e,null,t);return _n(r)};function we(e,t,r="g"){const n=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];return t=t.replace(new RegExp(`(\\${n.join("|\\")})`,r),"\\$1"),t=t.replace(/%/g,".*").replace(/_/g,"."),RegExp(`^${t}$`,r).test(e)}function Je(e,t){return we(e,t,"ig")}function Bt(e,t,r){return Oe(n=>we(n,e),t,r)}function ze(e,t,r){return Oe(n=>!we(n,e),t,r)}function Ke(e,t,r){return Oe(n=>Je(n,e),t,r)}function ns(e,t,r){return Oe(n=>!Je(n,e),t,r)}const Nt={$like:Bt,$notLike:ze,$notlike:ze,$ilike:Ke,$iLike:Ke,$notILike:ns},He=e=>typeof e<"u"?Number.parseInt(e,10):e;function ss(e,t){return Object.keys(t.filters).reduce((n,s)=>{const i=e[s],o=t.filters[s];if(o){const u=typeof o=="function"?o(i,t):i;u!==void 0&&(n[s]=u)}return n},{})}function os(e){return Object.keys(e).concat(Object.getOwnPropertySymbols(e)).reduce((r,n)=>(typeof n=="string"&&n.startsWith("$")||(r[n]=e[n]),r),{})}function is(e,t){const r=He(e);if(t&&(t.default||t.max)){const n=t.default||0,s=typeof r=="number"&&!Number.isNaN(r)&&r>=0?r:n,i=typeof t.max=="number"?t.max:Number.MAX_VALUE;return Math.min(s,i)}return r}const us=["$in","$nin","$lt","$lte","$gt","$gte","$ne","$or"],cs={$skip:e=>He(e),$sort:e=>typeof e!="object"||Array.isArray(e)?e:Object.keys(e).reduce((t,r)=>(t[r]=typeof e[r]=="object"?e[r]:He(e[r]),t),{}),$limit:(e,{paginate:t})=>is(e,t),$select:e=>Array.isArray(e)?e.map(t=>`${t}`):e,$or:e=>e,$and:e=>e};function as(e,t={}){const r=e||{},n={...t,filters:{...cs,...t.filters},operators:us.concat(t.operators||[])};return{filters:ss(r,n),query:os(r)}}const ls=["$sort","$limit","$skip","$select"],fs=["$in","$nin","$exists","eq","ne","$mod","$all","$not","$size","$type","$regex","$options","$where","$elemMatch"];function Ye(e){const{idField:t,itemStorage:r,tempStorage:n,cloneStorage:s,addItemToStorage:i,paramsForServer:o=[],whitelist:u=[],customSiftOperators:c={},customFilters:a=[]}=e,f=Object.assign({},Nt,c),h=l.computed(()=>fs.concat(u||[]).concat(Object.keys(f))),w=($,v=[])=>{$={...l.unref($)};const y=D._.omit($.query||{},...o),{query:m,filters:j}=as(y,{operators:h.value});let P=v.concat(r.list.value);return n&&$.temps&&P.push(...n.list.value),P=a.reduce((C,F)=>y[F.key]?F.operator(C,y[F.key],y):C,P),j.$or&&(m.$or=y.$or),j.$and&&(m.$and=y.$and),P=P.filter(rs(m,{operations:f})),{values:P,filters:j}};function d($){const v=l.computed(()=>{const y=l.unref($);y.query&&(y.query=Q(y.query));const m=w(y),j=m.filters;let P=m.values;const C=P.length;return j.$sort&&P.sort(je.sorter(j.$sort)),j.$skip&&(P=P.slice(j.$skip)),typeof j.$limit<"u"&&(P=P.slice(0,j.$limit)),{total:C,limit:j.$limit||0,skip:j.$skip||0,data:y.clones?P.map(F=>F.clone?F.clone(void 0,{useExisting:!0}):F):P}});return l.reactive({total:l.computed(()=>v.value.total),limit:l.computed(()=>v.value.limit),skip:l.computed(()=>v.value.skip),data:l.computed(()=>v.value.data)})}function I($){const v=d($);return l.computed(()=>v.data[0]||null)}function g($){return l.computed(()=>{if($={...l.unref($)},!$.query)throw new Error("params must contain a query object");return $.query=D._.omit($.query,...ls),d($).total})}const _=($,v)=>l.computed(()=>{const y=l.unref($);v=x(l.unref(v)||{}),v.query&&(v.query=Q(v.query));let m=null;const j=r.getItem(y)&&je.select(v,t)(r.getItem(y)),P=n&&n.getItem(y)&&je.select(v,"__tempId")(n.getItem(y));return j?m=j:P&&(m=P),v.clones&&m.clone?m.clone(void 0,{useExisting:!0}):m||null});function b($){const{items:v,isArray:y}=z(l.unref($)),m=v.map(j=>i(l.unref(j)));return y?m:m[0]}function S($,v={},y={}){const m=l.unref($),j=l.unref(v),P=l.unref(y);function C(F){return F.map(q=>{if(q=l.unref(q),(typeof q=="number"||typeof q=="string")&&(q=_(q).value),q==null)return null;const E={...q,...j};return i(E)}).filter(q=>q)}if(m===null){if(P!=null&&P.query&&!Object.keys(P==null?void 0:P.query).length)throw new Error('cannot perform multiple patchInStore with an empty query. You must explicitly provide a query. To patch all items, try using a query that matches all items, like "{ id: { $exists: true } }"');const F=d(P).data;return C(F)}else{const{items:F,isArray:R}=z(m),q=C(F);return R?q:q[0]}}function O($,v){if($===null&&(v!=null&&v.query)&&Object.keys(v==null?void 0:v.query).length){const y=s?s.list.value:[],{values:m}=w(v,y);return A(m)}else $!==null&&A($);return $}function A($){const{items:v}=z($);return v.forEach(y=>{if(typeof y=="string")r.removeItem(y),n==null||n.removeItem(y),s==null||s.removeItem(y);else{if(y.__isClone)return s==null?void 0:s.remove(y);if(y.__isTemp)return n==null?void 0:n.remove(y);r.remove(y),n==null||n.remove(y),s==null||s.remove(y)}}),$}return{findInStore:d,findOneInStore:I,countInStore:g,getFromStore:_,createInStore:b,patchInStore:S,removeFromStore:O}}function _e({getId:e,onRead:t=s=>s,beforeWrite:r=s=>s,assign:n=(s,i)=>Object.assign(s,i)}){const s=l.ref({}),i=l.computed(()=>Object.values(s.value)),o=l.computed(()=>Object.keys(s.value)),u=S=>!!s.value[S],c=S=>{const O=e(S);return u(O)},a=S=>{const O=s.value[S];return O?t(O):null},f=(S,O)=>{if(S==null)throw new Error("item has no id");return l.set(s.value,S,r(O)),a(S)},h=S=>{const O=e(S);return f(O,S)},w=S=>{const O=e(S),A=a(O);return A?n(A,S):f(O,S),a(O)},d=S=>{const O=e(S);return a(O)},I=S=>{const O=u(S);return O&&l.del(s.value,S),O};return{byId:s,list:i,ids:o,getId:e,clear:()=>{Object.keys(s.value).forEach(S=>{l.del(s.value,S)})},has:c,hasItem:u,get:d,getItem:a,set:h,setItem:f,remove:S=>{const O=e(S);return I(O)},removeItem:I,getKeys:()=>o.value,merge:w}}function Rt(e){const{getId:t,itemStorage:r,onRead:n,beforeWrite:s}=e,i=_e({getId:t,onRead:n,beforeWrite:s});function o(u){return i.has(u)&&i.remove(u),r.set(u)}return{tempStorage:i,moveTempToItems:o}}function Mt(e){const{itemStorage:t,tempStorage:r,onRead:n,beforeWrite:s}=e,i=(d,I={},{isClone:g})=>x(Object.assign({},d,I,{__isClone:g})),o=e.makeCopy||i,u=_e({getId:d=>{const I=t.getId(d);return I??r.getId(d)},onRead:n,beforeWrite:s});function c(d){return d.__isClone||(t.has(d)?t.merge(d):r.has(d)&&r.merge(d)),t.get(d)||r.get(d)||(t.getId(d)!=null?t.merge(d):r.getId(d)!=null&&r.merge(d)),t.get(d)||r.get(d)}function a(d,I={},g={}){const _=u.get(d);return c(d),_&&g.useExisting?_:h(d,I)}function f(d,I={}){const g=t.getId(d),_=o(d,I,{isClone:!1});return g?(t.merge(_),t.get(_)):(r.merge(_),r.get(_))}function h(d,I={}){const g=c(d);if(u.get(d)){const b=o(g,I,{isClone:!0});Object.keys(g).forEach(S=>{g[S]==null&&l.del(b,S)}),u.merge(b)}else{const b=o(d,I,{isClone:!0});u.set(b)}return u.get(d)}function w(d){return Object.defineProperty(d,"__isClone",{writable:!1,enumerable:!1,value:!0}),d}return{cloneStorage:u,clone:a,commit:f,reset:h,markAsClone:w}}function Xe(e){const{getIdField:t,setupInstance:r}=e,n=(d,I={},{isClone:g})=>{const _=x(d);return Object.assign(_,I),Object.defineProperty(_,"__isTemp",{configurable:!0,enumerable:!1,get(){return this[this.__idField]==null}}),ee(_,{__isClone:g,__tempId:d.__tempId})},s=_e({getId:t,beforeWrite:r,onRead:r}),{tempStorage:i,moveTempToItems:o}=Rt({getId:d=>d.__tempId,itemStorage:s,beforeWrite:r,onRead:r}),{cloneStorage:u,clone:c,commit:a,reset:f,markAsClone:h}=Mt({itemStorage:s,tempStorage:i,makeCopy:n,beforeWrite:d=>(h(d),r(d)),onRead:r});return{itemStorage:s,tempStorage:i,cloneStorage:u,clone:c,commit:a,reset:f,addItemToStorage:d=>{const I=t(d);return d=r(d),d.__isClone?u.merge(d):I!=null&&d.__tempId!=null?o(d):I!=null?s.merge(d):i&&d.__tempId!=null?i==null?void 0:i.merge(d):s.merge(d)}}}function ds(){return{skipGetIfExists:!1}}function ps(e){const t=Object.assign({},ds(),e),{idField:r,customSiftOperators:n}=t,{itemStorage:s,tempStorage:i,cloneStorage:o,clone:u,commit:c,reset:a,addItemToStorage:f}=Xe({getIdField:v=>v[r],setupInstance:S}),{findInStore:h,findOneInStore:w,countInStore:d,getFromStore:I,createInStore:g,patchInStore:_,removeFromStore:b}=Ye({idField:r,itemStorage:s,tempStorage:i,cloneStorage:o,addItemToStorage:f,customSiftOperators:n});function S(v){const y=Ne(v,{idField:r,clonesById:o.byId,clone:u,commit:c,reset:a,createInStore:g,removeFromStore:b});if(v.__isSetup)return y;{const m=t.setupInstance?t.setupInstance(y):y;return Object.defineProperty(m,"__isSetup",{value:!0}),m}}const O=l.computed(()=>!!l.unref(t.ssr));function A(){s.clear(),i.clear(),o.clear()}return{new:S,idField:r,isSsr:O,itemsById:s.byId,items:s.list,itemIds:s.ids,tempsById:i.byId,temps:i.list,tempIds:i.ids,clonesById:o.byId,clones:o.list,cloneIds:o.ids,clone:u,commit:c,reset:a,findInStore:h,findOneInStore:w,countInStore:d,createInStore:g,getFromStore:I,patchInStore:_,removeFromStore:b,clearAll:A}}var Qt={},H={};Object.defineProperty(H,"__esModule",{value:!0}),H.createDebug=H.setDebug=H.noopDebug=void 0;const le={};function Wt(){return function(){}}H.noopDebug=Wt;let Gt=Wt;function hs(e){Gt=e,Object.keys(le).forEach(t=>{le[t]=e(t)})}H.setDebug=hs;function ys(e){return le[e]||(le[e]=Gt(e)),(...t)=>le[e](...t)}H.createDebug=ys,function(e){var t=he&&he.__createBinding||(Object.create?function(o,u,c,a){a===void 0&&(a=c);var f=Object.getOwnPropertyDescriptor(u,c);(!f||("get"in f?!u.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return u[c]}}),Object.defineProperty(o,a,f)}:function(o,u,c,a){a===void 0&&(a=c),o[a]=u[c]}),r=he&&he.__exportStar||function(o,u){for(var c in o)c!=="default"&&!Object.prototype.hasOwnProperty.call(u,c)&&t(u,o,c)};Object.defineProperty(e,"__esModule",{value:!0}),e.createSymbol=e.isPromise=e._=e.stripSlashes=void 0;function n(o){return o.replace(/^(\/+)|(\/+)$/g,"")}e.stripSlashes=n,e._={each(o,u){o&&typeof o.forEach=="function"?o.forEach(u):e._.isObject(o)&&Object.keys(o).forEach(c=>u(o[c],c))},some(o,u){return Object.keys(o).map(c=>[o[c],c]).some(([c,a])=>u(c,a))},every(o,u){return Object.keys(o).map(c=>[o[c],c]).every(([c,a])=>u(c,a))},keys(o){return Object.keys(o)},values(o){return e._.keys(o).map(u=>o[u])},isMatch(o,u){return e._.keys(u).every(c=>o[c]===u[c])},isEmpty(o){return e._.keys(o).length===0},isObject(o){return typeof o=="object"&&!Array.isArray(o)&&o!==null},isObjectOrArray(o){return typeof o=="object"&&o!==null},extend(o,...u){return Object.assign(o,...u)},omit(o,...u){const c=e._.extend({},o);return u.forEach(a=>delete c[a]),c},pick(o,...u){return u.reduce((c,a)=>(o[a]!==void 0&&(c[a]=o[a]),c),{})},merge(o,u){return e._.isObject(o)&&e._.isObject(u)&&Object.keys(u).forEach(c=>{e._.isObject(u[c])?(o[c]||Object.assign(o,{[c]:{}}),e._.merge(o[c],u[c])):Object.assign(o,{[c]:u[c]})}),o}};function s(o){return e._.isObject(o)&&typeof o.then=="function"}e.isPromise=s;function i(o){return typeof Symbol<"u"?Symbol.for(o):o}e.createSymbol=i,r(H,e)}(Qt);function Vt(e){const{idField:t,isSsr:r}=e,n=e.defaultLimit||10,s=l.ref({});function i(){const{defaultLimit:a,defaultSkip:f}=s.value;s.value={defaultLimit:a,defaultSkip:f}}function o({qid:a,response:f,query:h={},preserveSsr:w=!1}){var F,R;const{data:d,total:I}=f,g=d.map(q=>ae(q,t)),_=new Date().getTime(),{queryId:b,queryParams:S,pageId:O,pageParams:A}=c({qid:a,query:h});s.value[a]||l.set(s.value,a,{}),!G(h,"$limit")&&G(f,"limit")&&l.set(s.value,"defaultLimit",f.limit),!G(h,"$skip")&&G(f,"skip")&&l.set(s.value,"defaultSkip",f.skip);const $={query:h,queryId:b,queryParams:S,pageId:O,pageParams:A,queriedAt:_,total:I},v=(R=(F=s.value[a])==null?void 0:F[b])==null?void 0:R[O],y=s.value[a]||{};Object.assign(y,{mostRecent:$}),l.set(y,b,y[b]||{});const m={total:I,queryParams:S};l.set(y,b,Object.assign({},y[b],m));const j=w?v==null?void 0:v.ssr:r.value,P={[O]:{pageParams:A,ids:g,queriedAt:_,ssr:!!j}};Object.assign(y[b],P);const C=Object.assign({},s.value[a],y);l.set(s.value,a,C)}function u(a){var g,_;const f=c(a),{qid:h,queryId:w,pageId:d}=f,I=(_=(g=s.value[h])==null?void 0:g[w])==null?void 0:_[d];I.ssr=!1}function c(a){const f=Q(a),{query:h={}}=f,w=f.qid||"default",d=(h==null?void 0:h.$limit)||n,I=(h==null?void 0:h.$skip)||0,g=d!==void 0?{$limit:d,$skip:I}:void 0,_=g?Ie(g):void 0,b=Qt._.omit(h,"$limit","$skip"),S=Ie(b);return{qid:w,query:h,queryId:S,queryParams:b,pageParams:g,pageId:_,isExpired:!1}}return{pagination:s,updatePaginationForQuery:o,unflagSsr:u,getQueryInfo:c,clearPagination:i}}function Ut(){return{find:0,count:0,get:0,create:0,update:0,patch:0,remove:0}}function Jt(){const e=l.ref(Ut()),t=l.ref({}),r=l.ref({}),n=l.ref({}),s=l.ref({}),i=l.computed(()=>e.value.find>0),o=l.computed(()=>e.value.count>0),u=l.computed(()=>e.value.get>0),c=l.computed(()=>e.value.create>0||Object.keys(t.value).length>0),a=l.computed(()=>e.value.update>0||Object.keys(r.value).length>0),f=l.computed(()=>e.value.patch>0||Object.keys(n.value).length>0),h=l.computed(()=>e.value.remove>0||Object.keys(s.value).length>0);function w(_,b){b?e.value[_]++:e.value[_]--}function d(_,b,S){if(_==null)return;let O;b==="create"?O=t.value:b==="update"?O=r.value:b==="patch"?O=n.value:b==="remove"&&(O=s.value),S?l.set(O,_,!0):l.del(O,_)}function I(..._){_.forEach(b=>{b!=null&&(l.del(t.value,b),l.del(r.value,b),l.del(n.value,b),l.del(s.value,b))})}function g(){e.value=Ut(),t.value={},r.value={},n.value={},s.value={}}return{isPending:e,createPendingById:t,updatePendingById:r,patchPendingById:n,removePendingById:s,isFindPending:i,isCountPending:o,isGetPending:u,isCreatePending:c,isUpdatePending:a,isPatchPending:f,isRemovePending:h,setPending:w,setPendingById:d,unsetPendingById:I,clearAllPending:g}}function zt(){const e=l.reactive({created:{},patched:{},updated:{},removed:{}});function t(n,s){const{items:i}=z(n);i.forEach(o=>{e[s][o]?r(n,s):(l.set(e[s],o,!0),setTimeout(()=>{r(n,s)},250))})}function r(n,s){const{items:i}=z(n);i.forEach(o=>{l.del(e[s],o)})}return{eventLocks:e,toggleEventLock:t,clearEventLock:r}}function gs(){const e=ce.reactive({});function t(i){return e[i]}function r(i,o){e[i]=o}function n(i){delete e[i]}function s(){Object.keys(e).forEach(i=>{n(i)})}return{resultsByQid:e,getQid:t,setQid:r,clearQid:n,clearAllQids:s}}function vs(){return{skipGetIfExists:!1}}function Kt(e){const t=Object.assign({},vs(),e),{idField:r,servicePath:n,whitelist:s,paramsForServer:i,defaultLimit:o,customSiftOperators:u,customFilters:c}=t,{itemStorage:a,tempStorage:f,cloneStorage:h,clone:w,commit:d,reset:I,addItemToStorage:g}=Xe({getIdField:J=>J[r],setupInstance:y}),{findInStore:_,findOneInStore:b,countInStore:S,getFromStore:O,createInStore:A,patchInStore:$,removeFromStore:v}=Ye({idField:r,itemStorage:a,tempStorage:f,cloneStorage:h,addItemToStorage:g,whitelist:s,paramsForServer:i,customSiftOperators:u,customFilters:c});function y(J){const pe=Ne(J,{idField:r,clonesById:h.byId,clone:w,commit:d,reset:I,createInStore:A,removeFromStore:v});if(J.__isSetup)return pe;{const $e=t.setupInstance?t.setupInstance(pe):pe;return Object.defineProperty($e,"__isSetup",{value:!0}),$e}}const m=Jt(),j=l.computed(()=>!!l.unref(t.ssr)),{pagination:P,clearPagination:C,updatePaginationForQuery:F,getQueryInfo:R,unflagSsr:q}=Vt({idField:r,isSsr:j,defaultLimit:o}),{resultsByQid:E,getQid:L,setQid:Y,clearQid:ie,clearAllQids:de}=gs();function xe(){a.clear(),f.clear(),h.clear(),C(),m.clearAllPending(),de()}const De=zt();return{new:y,idField:r,servicePath:n,isSsr:j,defaultLimit:o,itemsById:a.byId,items:a.list,itemIds:a.ids,tempsById:f.byId,temps:f.list,tempIds:f.ids,clonesById:h.byId,clones:h.list,cloneIds:h.ids,clone:w,commit:d,reset:I,findInStore:_,findOneInStore:b,countInStore:S,createInStore:A,getFromStore:O,patchInStore:$,removeFromStore:v,clearAll:xe,resultsByQid:E,getQid:L,setQid:Y,clearQid:ie,clearAllQids:de,whitelist:s,paramsForServer:i,pagination:P,updatePaginationForQuery:F,unflagSsr:q,getQueryInfo:R,...m,...De}}const U={};function ms(e){return`is${e.slice(0,1).toUpperCase()}${e.slice(1,e.length-1)}Pending`}function Ss(e){return{promise:null,isResolved:!1,getter:ms(e)}}function Is(e,t){return U[t]=U[t]||Ss(t),(!U[t].promise||U[t].isResolved)&&(U[t].promise=new Promise(r=>{const n=l.watch(()=>e[U[t].getter],async s=>{s||setTimeout(()=>{n(),U[t].isResolved=!0,r(U[t].isResolved)},0)},{immediate:!0})})),U[t].promise}var Os=bs;function bs(e,t,r,n){var s,i,o;return function(){if(o=this,i=Array.prototype.slice.call(arguments),s&&(r||n))return;if(!r)return a(),s=setTimeout(c,t),s;s=setTimeout(a,t),e.apply(o,i);function c(){a(),e.apply(o,i)}function a(){clearTimeout(s),s=null}}}const Ze=ye(Os);function Ht(e){if(!e.service||e.handleEvents===!1)return;const t=e.service,r=l.ref({}),n=l.ref({}),s=Ze(async()=>{const a=Object.values(r.value);a.length!==0&&(t.store.createInStore(a),r.value={})},e.debounceEventsTime||20,void 0,e.debounceEventsGuarantee);function i(a){const f=ae(a,t.store.idField);f&&(l.set(r,f,a),G(n.value,f)&&l.del(n,f),s())}const o=Ze(()=>{const a=Object.values(n.value);a.length!==0&&(t.store.removeFromStore(a),n.value={})},e.debounceEventsTime||20,void 0,e.debounceEventsGuarantee);function u(a){const f=ae(a,t.store.idField);f&&(l.set(n,f,a),G(r.value,f)&&l.del(r.value,f),o())}function c(a,f){var d;const h=(d=e.handleEvents)==null?void 0:d[a];if(h===!1)return;const w=ae(f,t.store.idField);if(a!=="created"&&t.store.eventLocks[a][w]){t.store.toggleEventLock(w,a);return}h&&!h(f,{service:t})||(e.debounceEventsTime?a==="removed"?u(f):i(f):a==="removed"?t.store.removeFromStore(f):t.store.createInStore(f))}t.on("created",a=>{const f=te(t,a);c("created",f)}),t.on("updated",a=>{const f=te(t,a);c("updated",f)}),t.on("patched",a=>{const f=te(t,a);c("patched",f)}),t.on("removed",a=>{const f=te(t,a);c("removed",f)})}function ws(){return async(e,t)=>{if(e.params.value&&(e.params=Q(e.params)),e.params.query&&(e.params.query=Q(e.params.query)),e.method==="find"){const r=e.params.query||{};r.$limit==null&&(r.$limit=e.service.store.defaultLimit),r.$skip==null&&(r.$skip=0),e.params.query=r}t&&await t()}}function Yt(){return async(e,t)=>{var s,i,o;const r=e.service.store;let n;if(!r.isSsr){const u=e.method==="find"?((s=e.params.query)==null?void 0:s.$limit)===0?"count":"find":e.method;r.setPending(u,!0),e.id!=null&&u!=="get"&&r.setPendingById(e.id,u,!0);const c=(i=e.data)==null?void 0:i.__isTemp,a=(o=e.data)==null?void 0:o.__tempId;c&&u==="create"&&r.setPendingById(e.data.__tempId,u,!0),n=()=>{r.setPending(u,!1);const f=e.id!=null?e.id:a;f!=null&&u!=="get"&&r.setPendingById(f,u,!1)}}try{await t()}catch(u){throw n&&n(),u}n&&n()}}function Xt(){return async(e,t)=>{const{id:r,method:n}=e,s=e.service.store,i=["update","patch","remove"].includes(n),u={update:"updated",patch:"patched",remove:"removed"}[n];i&&r&&!s.isSsr&&s.toggleEventLock(r,u),await t(),i&&r&&!s.isSsr&&s.clearEventLock(r,u)}}function Zt(){return async(e,t)=>{const{method:r,params:n}=e,s=e.service.store;if(r==="patch"&&n.data&&(e.data=n.data),t&&await t(),!e.params.skipStore){if(r==="remove")s.removeFromStore(e.result);else if(r==="create"){const i=gt(e.data,e.result);e.result=s.createInStore(i)}else r==="find"&&Array.isArray(e.result.data)?e.result.data=s.createInStore(e.result.data):e.result=s.createInStore(e.result);if(r==="find"&&e.result.total){const{qid:i="default",query:o,preserveSsr:u=!1}=e.params;s.updatePaginationForQuery({qid:i,response:e.result,query:o,preserveSsr:u})}}}}function xt(){return async(e,t)=>{var r;t&&await t(),e.service.new&&(Array.isArray((r=e.result)==null?void 0:r.data)?e.result.data=e.result.data.map(n=>e.service.new(n)):Array.isArray(e.result)?e.result=e.result.map(n=>e.service.new(n)):e.result=e.service.new(e.result))}}function _s(){return async(e,t)=>{const r=e.service.store;if(e.method==="find"){const{params:n}=e,s=r.getQueryInfo(n),i=r.pagination[s.qid],o=i==null?void 0:i[s.queryId],u=o==null?void 0:o[s.pageId];u!=null&&u.ssr&&(e.result={data:u.ids.map(c=>r.getFromStore(c).value),limit:u.pageParams.$limit,skip:u.pageParams.$skip,total:o.total,fromSsr:!0},n.preserveSsr||r.unflagSsr(n))}t&&await t()}}function Dt(){return async(e,t)=>{var r;if(e.method==="find"){const{params:n}=e,{query:s={}}=n;(n.paginate===!0||G(s,"$limit")||G(s,"$skip"))&&(n.paginate={default:!0})}t&&await t(),e.method==="find"&&!((r=e.result)!=null&&r.data)&&Array.isArray(e.result)&&(e.result={data:e.result,limit:e.params.$limit||e.result.length,skip:e.params.$skip||0,total:e.result.length})}}function er(){return async(e,t)=>{const{params:r,id:n}=e,s=e.service.store;if(e.method==="get"&&n!=null){const i=r.skipGetIfExists||s.skipGetIfExists;delete r.skipGetIfExists;const o=s.getFromStore(e.id,r);o&&i&&(e.result=o)}await t()}}function $s(){return async(e,t)=>{const{method:r,data:n,params:s,id:i}=e,o=e.service.store;let u,c;const a=r==="patch"&&!s.data&&(n.__isClone||s.diff);if(a){c=n;const f=o.getFromStore(i).value,h=Te(f,c,s.diff);if(u=x(f),s.eager!==!1&&n.commit(h),s.with){const w=Se(c,s.with);typeof s.with!="string"&&!Array.isArray(s.with)&&Object.assign(w,s.with),Object.assign(h,w)}e.data=h,Object.keys(e.data).length===0&&(e.result=c)}else e.data=x(n);try{await t()}catch(f){throw a&&c&&c.commit(u),f}}}function Ps(){return async(e,t)=>{const{params:r}=e,n=e.service.store;if(r.qid){const s=n.getQid(r.qid);if(s!==void 0)return n.isSsr||setTimeout(()=>{n.clearQid(r.qid)},500),e.result=s,await t()}await t(),r.qid&&n.isSsr&&n.setQid(r.qid,e.result)}}function tr(){return[ws(),Yt(),Xt(),Zt(),xt(),_s(),Dt(),er(),$s(),Ps()]}function rr(e,t){if(e.__isServiceInstance)return e;const{service:r,store:n}=t,s=(i,o)=>Object.assign(i,o);return Ce(e,{isPending(){return this.isCreatePending||this.isPatchPending||this.isRemovePending},isSavePending(){return this.isCreatePending||this.isPatchPending},isCreatePending(){return!!(n.createPendingById[this[n.idField]]||n.createPendingById[this.__tempId])},isPatchPending(){return!!n.patchPendingById[this[n.idField]]},isRemovePending(){return!!n.removePendingById[this[n.idField]]}}),ee(e,{__isServiceInstance:!0,save(i){return this[n.idField]!=null?this.patch(i):this.create(i)},create(i){return r.create(this,i).then(o=>s(this,o))},patch(i){const o=this[n.idField];if(o===void 0)throw new pr.BadRequest("the item has no id");return r.patch(o,this,i).then(u=>s(this,u))},remove(i){if(this.__isTemp)return n.removeFromStore(this.__tempId),Promise.resolve(this);{const o=this[n.idField];return r.remove(o,i).then(u=>s(this,u))}}}),e}function nr(e,t){const r={};Object.keys(t).forEach(n=>{const s=e[n],i=t[n],o=this.service(i);if(o||console.error(`there is no service at path ${i}. Check your storeAssociated config`,e,t),s&&o){const u=o.createInStore(s);r[n]=u}}),ee(e,r)}function sr(e,t,r){const n=JSON.stringify(t);r.setItem(e,n)}function or(e,t){const r=t.getItem(e.$id);if(r){const n=JSON.parse(r)||{};Object.assign(e,n)}}function ir(e,t,r=window.localStorage){or(e,r);const n=Ze(sr,500),s=l.computed(()=>D._.pick(e,...t));l.watch(s,i=>n(e.$id,i,r),{deep:!0})}function ur(e=window.localStorage){const t="service:";for(let r=0;r<e.length;r++){const n=e.key(r);n!=null&&n.startsWith(t)&&e.removeItem(n)}}function js(e,t){const r=N.feathers();r.defaultService=function(s){var v;const i=((v=t.services)==null?void 0:v[s])||{},o=i.idField||t.idField,u=i.defaultLimit||t.defaultLimit||10,c=(i.whitelist||[]).concat(t.whitelist||[]),a=(i.paramsForServer||[]).concat(t.paramsForServer||[]),f=i.handleEvents||t.handleEvents,h=i.debounceEventsTime!=null?i.debounceEventsTime:t.debounceEventsTime,w=i.debounceEventsGuarantee!=null?i.debounceEventsGuarantee:t.debounceEventsGuarantee,d=Object.assign({},i.customSiftOperators||{},t.customSiftOperators||{}),I=[...i.customFilters||[],...t.customFilters||[]];function g(y){const m=Object.assign(y,t.customizeStore?t.customizeStore(y):y);return Object.assign(m,i.customizeStore?i.customizeStore(m):m)}function _(y){const m=i.instanceServicePath||s,j=r.service(m),P=rr(y,{service:j,store:O}),C={app:r,service:j,servicePath:m},F=t.setupInstance?t.setupInstance(P,C):P;return i.setupInstance?i.setupInstance(F,C):F}const b=i.storeName||`service:${s}`,S=t.pinia._s.get(b);let O;if(S?O=S:O=Z.defineStore(b,()=>{const m=Kt({idField:o,servicePath:s,defaultLimit:u,whitelist:c,paramsForServer:a,customSiftOperators:d,customFilters:I,ssr:t.ssr,setupInstance:_}),j=g(m);return{...m,...j}})(t.pinia),!t.ssr&&t.storage){const y=["itemsById","pagination"],m=t.syncWithStorage===!0?y:Array.isArray(t.syncWithStorage)?t.syncWithStorage:[],j=i.syncWithStorage===!0?y:Array.isArray(i.syncWithStorage)?i.syncWithStorage:[],P=[...new Set([...m,...j])];P.length>0&&ir(O,P,t.storage)}const A=e.service(s),$=new $t(A,{store:O,servicePath:s});return Ht({service:$,debounceEventsTime:h,debounceEventsGuarantee:w,handleEvents:f}),$};const n=s=>{s.hooks({around:tr()})};return r.mixins.push(n),Ce(r,{authentication(){return e.authentication},authenticate(){return e.authenticate},reAuthenticate(){return e.reAuthenticate},logout(){return e.logout},clearStorage(){if(!t.ssr&&t.storage)return ur(t.storage)}}),Object.assign(r,{storeAssociated:nr,pushToStore(s,i){const o=r.service(i);return St(s,o)},defineVirtualProperty:Be,defineVirtualProperties:It}),r}class ks extends hr.FetchClient{async request(t,r){const n=Object.assign({},t,r.connection);n.headers=Object.assign({Accept:"application/json"},this.options.headers,n.headers),t.body&&(n.body=t.body);try{const s=await this.connection.raw(t.url,n),{_data:i,status:o}=s;return o===204?null:i}catch(s){throw s.data}}}const Es={"feathers-pinia":["useServiceInstance","useInstanceDefaults","useDataStore","useAuth","createPiniaClient","defineGetters","defineSetters","defineValues","useBackup"]};class fe extends Error{}fe.prototype.name="InvalidTokenError";function As(e){return decodeURIComponent(atob(e).replace(/(.)/g,(t,r)=>{let n=r.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}function qs(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return As(t)}catch{return atob(t)}}function Fs(e,t){if(typeof e!="string")throw new fe("Invalid token specified: must be a string");t||(t={});const r=t.header===!0?0:1,n=e.split(".")[r];if(typeof n!="string")throw new fe(`Invalid token specified: missing part #${r+1}`);let s;try{s=qs(n)}catch(i){throw new fe(`Invalid token specified: invalid base64 for part #${r+1} (${i.message})`)}try{return JSON.parse(s)}catch(i){throw new fe(`Invalid token specified: invalid json for part #${r+1} (${i.message})`)}}function Cs(e){const{api:t,servicePath:r,skipTokenCheck:n}=e,s=r?t.service(r):null,i=e.entityKey||"user",o=l.ref(),u=async()=>{},c=async E=>{throw E},a=e.onSuccess||u,f=e.onError||c,h=e.onInitSuccess||u,w=e.onInitError||u,d=e.onLogoutSuccess||u,I=e.onLogoutError||c,g=l.ref(null),_=l.computed(()=>!s||!g.value?null:(s==null?void 0:s.store.itemsById[g.value])||null),b=l.ref(null),S=()=>b.value=null,O=vt(),A=l.computed(()=>!!O.count.value),$=l.ref(!1),v=E=>{const L=E[i];if(s&&L){const Y=s.store.createInStore(L);g.value=Y[s.store.idField]||Y.__tempId}return $.value=!0,E},y=async E=>(O.add(),S(),o.value=t.authenticate(E).then(v).then(async L=>await a(L)||L).catch(L=>(b.value=L,f(L))).finally(()=>{O.sub()}),o.value),m=E=>{try{const L=Fs(E);return new Date().getTime()>L.exp*1e3}catch{return!1}},j=l.ref(!1),P=async()=>(O.add(),o.value=t.reAuthenticate().then(v).then(async E=>await h(E)||E).catch(E=>(E.value=E,w(E))).finally(()=>{O.sub(),j.value=!0}),o.value),C=vt(),F=l.computed(()=>!!C.count.value),R=async()=>(C.add(),t.logout().then(E=>(g.value=null,$.value=!1,E)).then(d).catch(E=>(E.value=E,I(E))).finally(()=>C.sub())),q=l.ref(null);return{userId:g,user:_,error:b,isPending:A,isLogoutPending:F,isInitDone:j,isAuthenticated:$,loginRedirect:q,getPromise:()=>o.value,isTokenExpired:m,authenticate:y,reAuthenticate:P,logout:R,clearError:S}}function Ts(e,t){const r=ce.ref(null);ce.watch(e,async i=>{var a,f;if(!e)return;const o=t==null?void 0:t.idField,u=o?i==null?void 0:i[o]:i==null?void 0:i.id,c=o?(a=r.value)==null?void 0:a[o]:(f=r.value)==null?void 0:f.id;u!==c&&(r.value=pt(i))},{immediate:!0});async function n(){const i=ce.unref(e),o=Te(r.value,i,t==null?void 0:t.onlyProps);if(Object.keys(o).length)try{const u=await e.value.save({data:o});r.value=pt(u)}catch(u){throw console.error("could not save",u),u}else return i}function s(i){if(r.value){const o=ce.isRef(i)?i.value:i;Object.assign(o,r.value)}return i}return{data:e,backup:r,save:n,restore:s}}p.$ilike=Ke,p.$like=Bt,p.$notLike=ze,p.OFetch=ks,p.PiniaService=$t,p.SERVICE=yt,p.clearStorage=ur,p.createPiniaClient=js,p.createSymbol=ht,p.defineGetters=Ce,p.defineSetters=Yr,p.defineValues=ee,p.defineVirtualProperties=It,p.defineVirtualProperty=Be,p.diff=Te,p.eventLocks=Xt,p.feathersPiniaAutoImport=Es,p.feathersPiniaHooks=tr,p.getArray=z,p.getExtendedQueryInfo=me,p.getId=ae,p.getParams=K,p.hasOwn=G,p.hydrateStore=or,p.iLike=Je,p.like=we,p.makeModelInstances=xt,p.normalizeFind=Dt,p.pickDiff=Se,p.pushToStore=St,p.restoreTempIds=gt,p.setPending=Yt,p.skipGetIfExists=er,p.sqlOperations=Nt,p.storeAssociated=nr,p.syncStore=Zt,p.syncWithStorage=ir,p.timeout=re,p.useAllStorageTypes=Xe,p.useAuth=Cs,p.useBackup=Ts,p.useDataStore=ps,p.useFind=wt,p.useGet=_t,p.useInstanceDefaults=en,p.useModelInstance=Ne,p.useQueuePromise=Is,p.useServiceClones=Mt,p.useServiceEventLocks=zt,p.useServiceEvents=Ht,p.useServiceInstance=rr,p.useServiceLocal=Ye,p.useServicePagination=Vt,p.useServicePending=Jt,p.useServiceStorage=_e,p.useServiceStore=Kt,p.useServiceTemps=Rt,p.writeToStorage=sr,Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=feathers-pinia.umd.cjs.map
