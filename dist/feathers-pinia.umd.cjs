(function(h,M){typeof exports=="object"&&typeof module<"u"?M(exports,require("@feathersjs/feathers"),require("pinia"),require("vue-demi"),require("@feathersjs/commons"),require("@feathersjs/adapter-commons"),require("vue"),require("@feathersjs/errors"),require("@feathersjs/rest-client")):typeof define=="function"&&define.amd?define(["exports","@feathersjs/feathers","pinia","vue-demi","@feathersjs/commons","@feathersjs/adapter-commons","vue","@feathersjs/errors","@feathersjs/rest-client"],M):(h=typeof globalThis<"u"?globalThis:h||self,M(h.feathersPinia={},h.feathers,h.pinia,h.VueDemi,h.commons,h.adapterCommons,h.Vue,h.errors,h.restClient))})(this,function(h,M,X,l,ee,de,ue,cr,ur){"use strict";var Ts=Object.defineProperty;var Ls=(h,M,X)=>M in h?Ts(h,M,{enumerable:!0,configurable:!0,writable:!0,value:X}):h[M]=X;var Ye=(h,M,X)=>(Ls(h,typeof M!="symbol"?M+"":M,X),X);var pe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function he(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ar=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var n,s,i;if(Array.isArray(t)){if(n=t.length,n!=r.length)return!1;for(s=n;s--!==0;)if(!e(t[s],r[s]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(i=Object.keys(t),n=i.length,n!==Object.keys(r).length)return!1;for(s=n;s--!==0;)if(!Object.prototype.hasOwnProperty.call(r,i[s]))return!1;for(s=n;s--!==0;){var o=i[s];if(!e(t[o],r[o]))return!1}return!0}return t!==t&&r!==r};const Xe=he(ar);var lr=Function.prototype.toString,$e=Object.create,fr=Object.prototype.toString,dr=function(){function e(){this._keys=[],this._values=[]}return e.prototype.has=function(t){return!!~this._keys.indexOf(t)},e.prototype.get=function(t){return this._values[this._keys.indexOf(t)]},e.prototype.set=function(t,r){this._keys.push(t),this._values.push(r)},e}();function pr(){return new dr}function hr(){return new WeakMap}var yr=typeof WeakMap<"u"?hr:pr;function je(e){if(!e)return $e(null);var t=e.constructor;if(t===Object)return e===Object.prototype?{}:$e(e);if(~lr.call(t).indexOf("[native code]"))try{return new t}catch{}return $e(e)}function gr(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}function vr(e){return e.flags}var mr=/test/g.flags==="g"?vr:gr;function Ze(e){var t=fr.call(e);return t.substring(8,t.length-1)}function Sr(e){return e[Symbol.toStringTag]||Ze(e)}var Ir=typeof Symbol<"u"?Sr:Ze,Or=Object.defineProperty,br=Object.getOwnPropertyDescriptor,xe=Object.getOwnPropertyNames,ke=Object.getOwnPropertySymbols,De=Object.prototype,et=De.hasOwnProperty,wr=De.propertyIsEnumerable,tt=typeof ke=="function";function _r(e){return xe(e).concat(ke(e))}var Pr=tt?_r:xe;function ye(e,t,r){for(var n=Pr(e),s=0,i=n.length,o=void 0,c=void 0;s<i;++s)if(o=n[s],!(o==="callee"||o==="caller")){if(c=br(e,o),!c){t[o]=r.copier(e[o],r);continue}!c.get&&!c.set&&(c.value=r.copier(c.value,r));try{Or(t,o,c)}catch{t[o]=c.value}}return t}function $r(e,t){var r=new t.Constructor;t.cache.set(e,r);for(var n=0,s=e.length;n<s;++n)r[n]=t.copier(e[n],t);return r}function jr(e,t){var r=new t.Constructor;return t.cache.set(e,r),ye(e,r,t)}function rt(e,t){return e.slice(0)}function kr(e,t){return e.slice(0,e.size,e.type)}function Er(e,t){return new t.Constructor(rt(e.buffer))}function qr(e,t){return new t.Constructor(e.getTime())}function nt(e,t){var r=new t.Constructor;return t.cache.set(e,r),e.forEach(function(n,s){r.set(s,t.copier(n,t))}),r}function Ar(e,t){return ye(e,nt(e,t),t)}function Fr(e,t){var r=je(t.prototype);t.cache.set(e,r);for(var n in e)et.call(e,n)&&(r[n]=t.copier(e[n],t));return r}function Cr(e,t){var r=je(t.prototype);t.cache.set(e,r);for(var n in e)et.call(e,n)&&(r[n]=t.copier(e[n],t));for(var s=ke(e),i=0,o=s.length,c=void 0;i<o;++i)c=s[i],wr.call(e,c)&&(r[c]=t.copier(e[c],t));return r}var Tr=tt?Cr:Fr;function Lr(e,t){var r=je(t.prototype);return t.cache.set(e,r),ye(e,r,t)}function Ee(e,t){return new t.Constructor(e.valueOf())}function Br(e,t){var r=new t.Constructor(e.source,mr(e));return r.lastIndex=e.lastIndex,r}function ge(e,t){return e}function st(e,t){var r=new t.Constructor;return t.cache.set(e,r),e.forEach(function(n){r.add(t.copier(n,t))}),r}function Mr(e,t){return ye(e,st(e,t),t)}var Rr=Array.isArray,qe=Object.assign,Nr=Object.getPrototypeOf||function(e){return e.__proto__},ot={array:$r,arrayBuffer:rt,blob:kr,dataView:Er,date:qr,error:ge,map:nt,object:Tr,regExp:Br,set:st},Qr=qe({},ot,{array:jr,map:Ar,object:Lr,set:Mr});function Wr(e){return{Arguments:e.object,Array:e.array,ArrayBuffer:e.arrayBuffer,Blob:e.blob,Boolean:Ee,DataView:e.dataView,Date:e.date,Error:e.error,Float32Array:e.arrayBuffer,Float64Array:e.arrayBuffer,Int8Array:e.arrayBuffer,Int16Array:e.arrayBuffer,Int32Array:e.arrayBuffer,Map:e.map,Number:Ee,Object:e.object,Promise:ge,RegExp:e.regExp,Set:e.set,String:Ee,WeakMap:ge,WeakSet:ge,Uint8Array:e.arrayBuffer,Uint8ClampedArray:e.arrayBuffer,Uint16Array:e.arrayBuffer,Uint32Array:e.arrayBuffer,Uint64Array:e.arrayBuffer}}function it(e){var t=qe({},ot,e),r=Wr(t),n=r.Array,s=r.Object;function i(o,c){if(c.prototype=c.Constructor=void 0,!o||typeof o!="object")return o;if(c.cache.has(o))return c.cache.get(o);if(c.prototype=Nr(o),c.Constructor=c.prototype&&c.prototype.constructor,!c.Constructor||c.Constructor===Object)return s(o,c);if(Rr(o))return n(o,c);var u=r[Ir(o)];return u?u(o,c):typeof o.then=="function"?o:s(o,c)}return function(c){return i(c,{Constructor:void 0,cache:yr(),copier:i,prototype:void 0})}}function Gr(e){return it(qe({},Qr,e))}var ct=Gr({}),Z=it({});function te(e,t){return Object.keys(t).forEach(r=>{Object.defineProperty(e,r,{enumerable:!1,configurable:!0,value:t[r]})}),e}function Ae(e,t){return Object.keys(t).forEach(r=>{Object.defineProperty(e,r,{enumerable:!1,configurable:!0,get:t[r]})}),e}function Vr(e,t){return Object.keys(t).forEach(r=>{Object.defineProperty(e,r,{enumerable:!1,configurable:!0,set:t[r]})}),e}function re(e,t){return t&&(Array.isArray(t)?t.map(r=>e.new(r)):t&&Array.isArray(t.data)?(t.data=t.data.map(r=>e.new(r)),t):e.new(t))}function ve({queryInfo:e,service:t,store:r,qid:n}){const i=r.pagination[n.value][e.queryId];if(!i)return null;const{total:o}=i,c=i[e.pageId];if(!c)return null;const{ids:u,queriedAt:a,ssr:f}=c,p=u.map(O=>r.itemsById[O]).filter(O=>O),I=re(t,p);return{...e,ids:u,items:I,total:o,queriedAt:a,queryState:i,ssr:f}||null}function V(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function z(e){const t=Array.isArray(e);return{items:t?e:[e],isArray:t}}function me(e,t){if(!t)return e;const n=(typeof t=="string"?[t]:Array.isArray(t)?t:Object.keys(t||e)).map(s=>s.toString().split(".")[0]);return ee._.pick(e,...n)}function Fe(e,t,r){const n=me(e,r),s=me(t,r);return typeof r!="string"&&!Array.isArray(r)&&Object.assign(s,r),Xe(n,s)?{}:Object.keys(s).reduce((c,u)=>(Xe(e[u],s[u])||(c[u]=s[u]),c),{})}function ut(e,t,r="__tempId"){const{items:n,isArray:s}=z(e),{items:i}=z(t);return i.forEach((o,c)=>{const u=n[c][r];u&&te(o,{[r]:u})}),s?i:i[0]}function Ce(e){return typeof e=="object"&&e!=null?e.toString():e}function ae(e,t){if(e){if(t&&e[t]!==void 0)return Ce(e[t]);if(e.id!==void 0)return Ce(e.id);if(e._id!==void 0)return Ce(e._id)}}function K(e){return e?Z(l.unref(e)):{}}function ne(e){return new Promise(t=>setTimeout(t,e))}function at(){const e=l.ref(0);return{count:e,add:()=>{e.value=e.value+1},sub:()=>{e.value=e.value===0?0:e.value-1}}}const Ur=e=>e!==null&&typeof e=="object",Jr=Array.isArray;function lt(e){return e!==null&&!l.isRef(e)&&typeof e=="object"?W(e):l.unref(e)}const zr=e=>e.map(lt);function Kr(e){const t={};return Object.keys(e).forEach(r=>{t[r]=lt(e[r])}),t}function W(e){const t=l.isRef(e)?l.unref(e):e;return Ur(t)?Jr(t)?zr(t):Kr(t):t}function Hr(e,t){const r=Object.keys(t),n=ee._.omit(e,...r);return Object.assign(t,Z(n))}function ft(e,t){if(!e)return e;const r=n=>t.createInStore(n);return Array.isArray(e)?e.map(r):r(e)}function Te(e,t,r){const n={enumerable:!1};typeof r=="function"?n.get=function(){return r(this)}:n.value=r,Object.defineProperty(e,t,n)}function dt(e,t){Object.keys(t).forEach(r=>Te(e,r,t[r]))}const Yr=["update","hooks","setMaxListeners","getMaxListeners","addListener","prependListener","once","prependOnceListener","removeListener","off","removeAllListeners","listeners","rawListeners","emit","eventNames","listenerCount","on"];function pt(e){return typeof e=="function"?e():l.unref(e)}typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const ht=()=>{};function Xr(e,t){function r(...n){return new Promise((s,i)=>{Promise.resolve(e(()=>t.apply(this,n),{fn:t,thisArg:this,args:n})).then(s).catch(i)})}return r}function Zr(e,t={}){let r,n,s=ht;const i=c=>{clearTimeout(c),s(),s=ht};return c=>{const u=pt(e),a=pt(t.maxWait);return r&&i(r),u<=0||a!==void 0&&a<=0?(n&&(i(n),n=null),Promise.resolve(c())):new Promise((f,p)=>{s=t.rejectOnCancel?p:f,a&&!n&&(n=setTimeout(()=>{r&&i(r),n=null,f(c())},a)),r=setTimeout(()=>{n&&i(n),n=null,f(c())},u)})}}function xr(e,t=200,r={}){return Xr(Zr(t,r),e)}var Dr=function(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var r=typeof t.cycles=="boolean"?t.cycles:!1,n=t.cmp&&function(i){return function(o){return function(c,u){var a={key:c,value:o[c]},f={key:u,value:o[u]};return i(a,f)}}}(t.cmp),s=[];return function i(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var c,u;if(Array.isArray(o)){for(u="[",c=0;c<o.length;c++)c&&(u+=","),u+=i(o[c])||"null";return u+"]"}if(o===null)return"null";if(s.indexOf(o)!==-1){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=s.push(o)-1,f=Object.keys(o).sort(n&&n(o));for(u="",c=0;c<f.length;c++){var p=f[c],I=i(o[p]);I&&(u&&(u+=","),u+=JSON.stringify(p)+":"+I)}return s.splice(a,1),"{"+u+"}"}}(e)};const Se=he(Dr);function en(e,t){const{queryId:r,pageId:n}=t,s=e[r],i=s&&s[n];return i&&i.ids||[]}function tn(e,t,r){const n=r.qid||"default",s=e.pagination[n]||{},i=e.getQueryInfo(r);return en(s,i).map(u=>t.getFromStore(u).value).filter(u=>u)}function rn(e,t){const{queryId:r}=t,n=e[r]||{};return[...new Set(Object.keys(n).filter(i=>!["total","queryParams"].includes(i)).reduce((i,o)=>{var c;return i=i.concat(((c=n==null?void 0:n[o])==null?void 0:c.ids)||[]),i},[]))]||[]}function nn(e,t,r){const n=r.qid||"default",s=e.pagination[n]||{},i=e.getQueryInfo(r);return rn(s,i).map(u=>t.getFromStore(u).value).filter(u=>u)}function sn(e){const{limit:t,skip:r,total:n,request:s}=e,i=l.computed(()=>n.value?Math.ceil(n.value/t.value):1),o=l.computed({set(g){g<1?g=1:g>i.value&&(g=i.value);const $=t.value*Math.floor(g-1);r.value=$},get(){const g=r.value||0;return i.value===0?0:Math.floor(g/t.value+1)}}),c=l.computed(()=>o.value-1>0),u=l.computed(()=>o.value<i.value),a=async()=>{s!=null&&s.value&&await s.value};return{pageCount:i,currentPage:o,canPrev:c,canNext:u,toStart:async()=>(o.value=1,await ne(0),a()),toEnd:async()=>(o.value=i.value,await ne(0),a()),toPage:async g=>(o.value=g,await ne(0),a()),next:async()=>(o.value++,await ne(0),a()),prev:async()=>(o.value--,await ne(0),a())}}function yt(e,t={},r){var nr,sr,or,ir;const{pagination:n,debounce:s=100,immediate:i=!0,watch:o=!0,paginateOn:c="client"}=t,{service:u}=r,{store:a}=u,f=l.computed(()=>{var k;return((k=e.value)==null?void 0:k.qid)||"default"}),p=(n==null?void 0:n.limit)||l.ref(((sr=(nr=e.value)==null?void 0:nr.query)==null?void 0:sr.$limit)||a.defaultLimit),I=(n==null?void 0:n.skip)||l.ref(((ir=(or=e.value)==null?void 0:or.query)==null?void 0:ir.$skip)||0),d=l.computed(()=>{var C;const k=W(((C=e.value)==null?void 0:C.query)||{});return{...e.value,query:{...k,$limit:p.value,$skip:I.value}}}),O=l.computed(()=>{var ce;const k=W(((ce=e.value)==null?void 0:ce.query)||{}),C=ee._.omit(k,"$limit","$skip");return{...e.value,query:C}}),g=l.ref(!1),$=l.ref(!1),b=l.ref(!1),v=l.ref(null),P=()=>v.value=null,m=l.ref(W(e.value||{}));function w(){Se(m.value)!==Se(d.value)&&(m.value=d.value)}let y=()=>!0;const S=k=>{y=k},_=l.computed(()=>{if(!a.pagination[f.value])return null;const C=a.getQueryInfo(m.value);return ve({queryInfo:C,service:u,store:a,qid:f})}),j=l.computed(()=>{if(!a.pagination[f.value])return null;const C=a.getQueryInfo(d.value);return ve({queryInfo:C,service:u,store:a,qid:f})}),E=l.computed(()=>(g.value?_.value:j.value)==null&&c!=="client"?[]:c==="server"?nn(a,u,m.value):u.findInStore(W(O.value)).data.filter(Q=>Q)),A=l.computed(()=>{const k=g.value?_.value:j.value;if(k==null)return[];const C=E.value,Q=k.items.find(He=>He),ce=C.findIndex(He=>He[a.idField]===Q[a.idField]),Pe=Math.min(ce,I.value);return C.slice(0,Pe)}),R=l.computed(()=>{const k=A.value,C=I.value+(k.length-I.value);return{...d.value,query:{...d.value.query,$limit:p.value,$skip:C}}}),F=l.computed(()=>c==="server"?tn(a,u,m.value):c==="hybrid"?u.findInStore(W(R)).data.filter(C=>C):u.findInStore(W(d)).data.filter(C=>C)),B=l.ref([]),q=l.computed(()=>B.value[B.value.length-1]||null),L=l.computed(()=>B.value[B.value.length-2]||null),Y=l.ref(0),x=l.ref(null);function we(){var k;(k=j.value)!=null&&k.ssr||($.value||($.value=!0),P(),g.value||(g.value=!0),b.value&&(b.value=!1))}async function Ke(k){const C=l.unref(k??(c==="client"?O.value:d.value));if(!y())return Promise.resolve({data:[]});we(),Y.value++;try{const Q=await u.find(C);if(Q.total){const ce=a.getQueryInfo(d.value),Pe=ve({queryInfo:ce,service:u,store:a,qid:f});Pe&&B.value.push(Pe),B.value.length>2&&B.value.shift()}return b.value=!0,Q}catch(Q){throw v.value=Q,Q}finally{g.value=!1}}const tr=xr(Ke,s),N=async k=>{e.value!==null&&(j.value&&w(),y()&&we(),x.value=tr(k),await x.value,w())},D=l.computed(()=>{if(["server","hybrid"].includes(c)){const k=j.value||_.value;return(k==null?void 0:k.total)||0}else return u.countInStore(O.value).value}),_e=sn({limit:p,skip:I,total:D,request:x}),{pageCount:Ps,currentPage:$s,canPrev:js,canNext:ks,toStart:Es,toEnd:qs,toPage:As,next:Fs,prev:Cs}=_e,rr=l.computed(()=>(setTimeout(()=>{l.ref(D.value)},0),a.isSsr));return rr.value?i&&N():["server","hybrid"].includes(c)&&o&&(l.watch(d,()=>{N()},{immediate:!1,flush:"sync"}),i&&N()),c==="server"&&u.on&&(u.on("created",()=>{N()}),u.on("patched",()=>{N()}),u.on("removed",()=>{N()})),l.reactive({paramsWithPagination:d,isSsr:rr,qid:f,data:F,allLocalData:E,total:D,limit:p,skip:I,currentQuery:j,cachedQuery:_,latestQuery:q,previousQuery:L,find:N,request:x,requestCount:Y,queryWhen:S,isPending:l.computed(()=>g.value),haveBeenRequested:l.computed(()=>$.value),haveLoaded:l.computed(()=>b.value),error:l.computed(()=>v.value),clearError:P,pageCount:Ps,currentPage:$s,canPrev:js,canNext:ks,next:Fs,prev:Cs,toStart:Es,toEnd:qs,toPage:As})}function gt(e,t=l.ref({}),r){const{service:n}=r,s=l.isRef(e)?e:l.ref(e),i=l.isRef(t)?t:l.ref(t),{immediate:o=!0,watch:c=!0}=i.value,u=l.computed(()=>n.store.isSsr),a=l.ref(!1),f=l.ref(!1),p=l.ref(null),I=()=>p.value=null,d=l.ref([]),O=l.computed(()=>d.value.length&&d.value[d.value.length-1]),g=l.computed(()=>a.value&&O.value!=null?n.store.getFromStore(O.value,i).value:n.store.getFromStore(s.value,i).value),$=n.store.getFromStore,b=l.computed(()=>!!g.value);let v=()=>!0;const P=_=>{v=_},m=l.ref(0),w=l.ref(null);async function y(){const _=l.unref(s),j=l.unref(i);if(v()){if(_==null)return null;m.value++,f.value=!0,a.value=!0,p.value=null;try{const E=await n.get(_,j);return E&&_&&d.value.push(_),E}catch(E){p.value=E}finally{a.value=!1}}}async function S(){return w.value=y(),await w.value}return u.value?o&&S():c&&l.watch(s,async()=>{await S()},{immediate:o,flush:"pre"}),l.reactive({params:i,isSsr:u,data:g,ids:d,getFromStore:$,get:S,request:w,requestCount:m,queryWhen:P,isPending:l.computed(()=>a.value),hasBeenRequested:l.computed(()=>f.value),hasLoaded:l.computed(()=>b.value),error:l.computed(()=>p.value),clearError:I})}class vt{constructor(t,r){Ye(this,"store");Ye(this,"servicePath","");this.service=t,this.options=r,this.store=r.store,this.servicePath=r.servicePath;const n=Object.getOwnPropertyNames(Object.getPrototypeOf(this)).concat(Yr);for(const s in t)if(typeof t[s]=="function"&&!n.includes(s)){const i=this;i[s]=t[s].bind(t)}}new(t={}){const r=this.store.new(t);return l.reactive(r)}async find(t){const r=K(t);return await this.service.find(r)}async findOne(t){const r=K(t);r.query=r.query||{},r.query.$limit=1;const n=await this.service.find(r);return(n.data||n)[0]||null}async count(t){const r=K(t);return r.query=r.query||{},r.query.$limit=0,await this.service.find(r)}async get(t,r){const n=K(r);return await this.service.get(t,n)}async create(t,r){const n=K(r);return await this.service.create(t,n)}async patch(t,r,n){const s=K(n);return await this.service.patch(t,r,s)}async remove(t,r){const n=K(r);return await this.service.remove(l.unref(t),n)}findInStore(t){const r=this.store.findInStore(t);return l.reactive({...r,data:l.computed(()=>r.data.map(n=>re(this,n)))})}findOneInStore(t){return this.store.findOneInStore(t)}countInStore(t){return this.store.countInStore(t)}getFromStore(t,r){return this.store.getFromStore(t,r)}createInStore(t){return this.store.createInStore(t)}patchInStore(t,r={},n={}){return this.store.patchInStore(t,r,n)}removeFromStore(t,r){var s;const n=t!=null?this.getFromStore(t).value:null;if(n)return this.store.removeFromStore(n);if(t==null&&((s=l.unref(r))!=null&&s.query))return this.store.removeByQuery(r)}useFind(t,r){const n=l.isRef(t)?t:l.ref(t);return yt(n,r,{service:this})}useGet(t,r=l.ref({})){const n=l.isRef(t)?t:l.ref(t),s=l.isRef(r)?r:l.ref(r);return gt(n,s,{service:this})}useGetOnce(t,r={}){const n=l.isRef(r)?r:l.ref(r);Object.assign(n.value,{immediate:!1});const s=this.useGet(t,n);return s.queryWhen(()=>!s.data),s.get(),s}on(t,r){return this.service.on(t,r)}emit(t,...r){return this.service.emit(t,...r)}removeListener(t,r){return this.service.removeListener(t,r)}}var mt={exports:{}};/*!
 * isomorphic-mongo-objectid - v@version@
 * Pure JavaScript implementation of mongodb ObjectId for the browser and server
 * https://github.com/john-doherty/isomorphic-mongo-objectid
 * @author John Doherty <www.johndoherty.info>
 * @license MIT
 */(function(e){(function(){var t=0,r=Math.floor(Math.random()*32767),n=Math.floor(Math.random()*16777216);if(typeof window<"u"){var s=window.localStorage,i=parseInt(s.mongoMachineId,10);i>=0&&i<=16777215&&(n=Math.floor(s.mongoMachineId)),s.mongoMachineId=n}function o(){var c=arguments;if(!(this instanceof o))return c.length>0?new o(c[0],c[1],c[2],c[3]):new o;typeof c[0]=="object"?(this.timestamp=c[0].timestamp,this.machine=c[0].machine,this.pid=c[0].pid,this.increment=c[0].increment):typeof c[0]=="string"&&c[0].length===24?(this.timestamp=+("0x"+c[0].substr(0,8)),this.machine=+("0x"+c[0].substr(8,6)),this.pid=+("0x"+c[0].substr(14,4)),this.increment=+("0x"+c[0].substr(18,6))):c.length===4&&c[0]!==null?(this.timestamp=c[0],this.machine=c[1],this.pid=c[2],this.increment=c[3]):(this.timestamp=Math.floor(new Date().valueOf()/1e3),this.machine=n,this.pid=r,this.increment=t++,t>16777215&&(t=0))}o.prototype.getDate=function(){return new Date(this.timestamp*1e3)},o.prototype.toArray=function(){var c=this.toString(),u=[],a;for(a=0;a<12;a++)u[a]=parseInt(c.slice(a*2,a*2+2),16);return u},o.prototype.toString=function(){var c=this.timestamp.toString(16),u=this.machine.toString(16),a=this.pid.toString(16),f=this.increment.toString(16);return["00000000".substr(0,8-c.length)+c,"000000".substr(0,6-u.length)+u,"0000".substr(0,4-a.length)+a,"000000".substr(0,6-f.length)+f].join("")},e.exports=o})()})(mt);var on=mt.exports,cn=on;const un=he(cn);function Le(e,t){if(e.__isStoreInstance)return e;const{idField:r,clonesById:n,clone:s,commit:i,reset:o,createInStore:c,removeFromStore:u}=t,a=e.__isClone||!1;return Object.defineProperty(e,"__isTemp",{configurable:!0,enumerable:!1,get(){return this[this.__idField]==null}}),te(e,{__isStoreInstance:!0,__isClone:a,__idField:r,__tempId:e[r]==null&&e.__tempId==null?new un().toString():e.__tempId||void 0,hasClone(){const p=this[this.__idField]||this.__tempId;return n.value[p]||null},clone(p={},I={}){return s(this,p,I)},commit(p={}){return i(this,p)},reset(p={}){return o(this,p)},createInStore(){return c(this)},removeFromStore(){return u(this)}})}/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Be=function(e,t){return Be=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=n[s])},Be(e,t)};function T(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Be(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Me=function(e){var t="[object "+e+"]";return function(r){return an(r)===t}},an=function(e){return Object.prototype.toString.call(e)},se=function(e){return e instanceof Date?e.getTime():oe(e)?e.map(se):e&&typeof e.toJSON=="function"?e.toJSON():e},ln=function(e){return e??null},oe=Me("Array"),fn=Me("Object"),dn=Me("Function"),pn=function(e){return e&&(e.constructor===Object||e.constructor===Array||e.constructor.toString()==="function Object() { [native code] }"||e.constructor.toString()==="function Array() { [native code] }")&&!e.toJSON},Re=function(e,t){if(e==null&&e==t||e===t)return!0;if(Object.prototype.toString.call(e)!==Object.prototype.toString.call(t))return!1;if(oe(e)){if(e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(!Re(e[r],t[r]))return!1;return!0}else if(fn(e)){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var s in e)if(!Re(e[s],t[s]))return!1;return!0}return!1},Ne=function(e,t,r,n,s,i){var o=t[n];if(oe(e)&&isNaN(Number(o))){for(var c=0,u=e.length;c<u;c++)if(!Ne(e[c],t,r,n,c,e))return!1}return n===t.length||e==null?r(e,s,i,n===0):Ne(e[o],t,r,n+1,o,e)},G=function(){function e(t,r,n,s){this.params=t,this.owneryQuery=r,this.options=n,this.name=s,this.init()}return e.prototype.init=function(){},e.prototype.reset=function(){this.done=!1,this.keep=!1},e}(),Qe=function(e){T(t,e);function t(r,n,s,i){var o=e.call(this,r,n,s)||this;return o.children=i,o}return t.prototype.reset=function(){this.keep=!1,this.done=!1;for(var r=0,n=this.children.length;r<n;r++)this.children[r].reset()},t.prototype.childrenNext=function(r,n,s,i){for(var o=!0,c=!0,u=0,a=this.children.length;u<a;u++){var f=this.children[u];if(f.done||f.next(r,n,s,i),f.keep||(c=!1),f.done){if(!f.keep)break}else o=!1}this.done=o,this.keep=c},t}(G),St=function(e){T(t,e);function t(r,n,s,i,o){var c=e.call(this,r,n,s,i)||this;return c.name=o,c}return t}(Qe),hn=function(e){T(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.propop=!0,r}return t.prototype.next=function(r,n,s,i){this.childrenNext(r,n,s,i)},t}(Qe),We=function(e){T(t,e);function t(r,n,s,i,o){var c=e.call(this,n,s,i,o)||this;return c.keyPath=r,c.propop=!0,c._nextNestedValue=function(u,a,f,p){return c.childrenNext(u,a,f,p),!c.done},c}return t.prototype.next=function(r,n,s){Ne(r,this.keyPath,this._nextNestedValue,0,n,s)},t}(Qe),Ge=function(e,t){if(e instanceof Function)return e;if(e instanceof RegExp)return function(n){var s=typeof n=="string"&&e.test(n);return e.lastIndex=0,s};var r=se(e);return function(n){return t(r,se(n))}},U=function(e){T(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.propop=!0,r}return t.prototype.init=function(){this._test=Ge(this.params,this.options.compare)},t.prototype.next=function(r,n,s){(!Array.isArray(s)||s.hasOwnProperty(n))&&this._test(r,n,s)&&(this.done=!0,this.keep=!0)},t}(G),Ie=function(e,t,r){return new U(e,t,r)},yn=function(e){return function(t,r,n,s){return e(t,r,n,s)}},Oe=function(e){return yn(function(t,r,n,s){var i=typeof se(t),o=e(t);return new U(function(c){var u=ln(c);return typeof se(u)===i&&o(u)},r,n,s)})},gn=function(e,t,r,n){var s=n.operations[e];return s||It(e),s(t,r,n,e)},It=function(e){throw new Error("Unsupported operation: "+e)},Ot=function(e,t){for(var r in e)if(t.operations.hasOwnProperty(r)||r.charAt(0)==="$")return!0;return!1},vn=function(e,t,r,n,s){if(Ot(t,s)){var i=bt(t,r,s),o=i[0],c=i[1];if(c.length)throw new Error("Property queries must contain only operations, or exact objects.");return new We(e,t,n,s,o)}return new We(e,t,n,s,[new U(t,n,s)])},ie=function(e,t,r){t===void 0&&(t=null);var n=r===void 0?{}:r,s=n.compare,i=n.operations,o={compare:s||Re,operations:Object.assign({},i||{})},c=bt(e,null,o),u=c[0],a=c[1],f=[];return u.length&&f.push(new We([],e,t,o,u)),f.push.apply(f,a),f.length===1?f[0]:new hn(e,t,o,f)},bt=function(e,t,r){var n=[],s=[];if(!pn(e))return n.push(new U(e,e,r)),[n,s];for(var i in e)if(r.operations.hasOwnProperty(i)){var o=gn(i,e[i],e,r);if(o&&!o.propop&&t&&!r.operations[t])throw new Error("Malformed query. "+i+" cannot be matched against property.");o!=null&&n.push(o)}else i.charAt(0)==="$"?It(i):s.push(vn(i.split("."),e[i],i,e,r));return[n,s]},mn=function(e){return function(t,r,n){return e.reset(),e.next(t,r,n),e.keep}},Sn=function(e){T(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.propop=!0,r}return t.prototype.init=function(){this._test=Ge(this.params,this.options.compare)},t.prototype.reset=function(){e.prototype.reset.call(this),this.keep=!0},t.prototype.next=function(r){this._test(r)&&(this.done=!0,this.keep=!1)},t}(G),In=function(e){T(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.propop=!0,r}return t.prototype.init=function(){if(!this.params||typeof this.params!="object")throw new Error("Malformed query. $elemMatch must by an object.");this._queryOperation=ie(this.params,this.owneryQuery,this.options)},t.prototype.reset=function(){e.prototype.reset.call(this),this._queryOperation.reset()},t.prototype.next=function(r){if(oe(r)){for(var n=0,s=r.length;n<s;n++){this._queryOperation.reset();var i=r[n];this._queryOperation.next(i,n,r,!1),this.keep=this.keep||this._queryOperation.keep}this.done=!0}else this.done=!1,this.keep=!1},t}(G),On=function(e){T(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.propop=!0,r}return t.prototype.init=function(){this._queryOperation=ie(this.params,this.owneryQuery,this.options)},t.prototype.reset=function(){e.prototype.reset.call(this),this._queryOperation.reset()},t.prototype.next=function(r,n,s,i){this._queryOperation.next(r,n,s,i),this.done=this._queryOperation.done,this.keep=!this._queryOperation.keep},t}(G),wt=function(e){T(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.propop=!0,r}return t.prototype.init=function(){},t.prototype.next=function(r){oe(r)&&r.length===this.params&&(this.done=!0,this.keep=!0)},t}(G),_t=function(e){if(e.length===0)throw new Error("$and/$or/$nor must be a nonempty array")},Pt=function(e){T(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.propop=!1,r}return t.prototype.init=function(){var r=this;_t(this.params),this._ops=this.params.map(function(n){return ie(n,null,r.options)})},t.prototype.reset=function(){this.done=!1,this.keep=!1;for(var r=0,n=this._ops.length;r<n;r++)this._ops[r].reset()},t.prototype.next=function(r,n,s){for(var i=!1,o=!1,c=0,u=this._ops.length;c<u;c++){var a=this._ops[c];if(a.next(r,n,s),a.keep){i=!0,o=a.keep;break}}this.keep=o,this.done=i},t}(G),bn=function(e){T(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.propop=!1,r}return t.prototype.next=function(r,n,s){e.prototype.next.call(this,r,n,s),this.keep=!this.keep},t}(Pt),$t=function(e){T(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.propop=!0,r}return t.prototype.init=function(){var r=this;this._testers=this.params.map(function(n){if(Ot(n,r.options))throw new Error("cannot nest $ under "+r.name.toLowerCase());return Ge(n,r.options.compare)})},t.prototype.next=function(r,n,s){for(var i=!1,o=!1,c=0,u=this._testers.length;c<u;c++){var a=this._testers[c];if(a(r)){i=!0,o=!0;break}}this.keep=o,this.done=i},t}(G),wn=function(e){T(t,e);function t(r,n,s,i){var o=e.call(this,r,n,s,i)||this;return o.propop=!0,o._in=new $t(r,n,s,i),o}return t.prototype.next=function(r,n,s,i){this._in.next(r,n,s),oe(s)&&!i?this._in.keep?(this.keep=!1,this.done=!0):n==s.length-1&&(this.keep=!0,this.done=!0):(this.keep=!this._in.keep,this.done=!0)},t.prototype.reset=function(){e.prototype.reset.call(this),this._in.reset()},t}(G),_n=function(e){T(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.propop=!0,r}return t.prototype.next=function(r,n,s){s.hasOwnProperty(n)===this.params&&(this.done=!0,this.keep=!0)},t}(G),Pn=function(e){T(t,e);function t(r,n,s,i){var o=e.call(this,r,n,s,r.map(function(c){return ie(c,n,s)}),i)||this;return o.propop=!1,_t(r),o}return t.prototype.next=function(r,n,s,i){this.childrenNext(r,n,s,i)},t}(St),$n=function(e){T(t,e);function t(r,n,s,i){var o=e.call(this,r,n,s,r.map(function(c){return ie(c,n,s)}),i)||this;return o.propop=!0,o}return t.prototype.next=function(r,n,s,i){this.childrenNext(r,n,s,i)},t}(St),jn=function(e,t,r){return new U(e,t,r)},kn=function(e,t,r,n){return new Sn(e,t,r,n)},En=function(e,t,r,n){return new Pt(e,t,r,n)},qn=function(e,t,r,n){return new bn(e,t,r,n)},An=function(e,t,r,n){return new In(e,t,r,n)},Fn=function(e,t,r,n){return new wn(e,t,r,n)},Cn=function(e,t,r,n){return new $t(e,t,r,n)},Tn=Oe(function(e){return function(t){return t!=null&&t<e}}),Ln=Oe(function(e){return function(t){return t===e||t<=e}}),Bn=Oe(function(e){return function(t){return t!=null&&t>e}}),Mn=Oe(function(e){return function(t){return t===e||t>=e}}),Rn=function(e,t,r){var n=e[0],s=e[1];return new U(function(i){return se(i)%n===s},t,r)},Nn=function(e,t,r,n){return new _n(e,t,r,n)},Qn=function(e,t,r){return new U(new RegExp(e,t.$options),t,r)},Wn=function(e,t,r,n){return new On(e,t,r,n)},jt={number:function(e){return typeof e=="number"},string:function(e){return typeof e=="string"},bool:function(e){return typeof e=="boolean"},array:function(e){return Array.isArray(e)},null:function(e){return e===null},timestamp:function(e){return e instanceof Date}},Gn=function(e,t,r){return new U(function(n){if(typeof e=="string"){if(!jt[e])throw new Error("Type alias does not exist");return jt[e](n)}return n!=null?n instanceof e||n.constructor===e:!1},t,r)},Vn=function(e,t,r,n){return new Pn(e,t,r,n)},Un=function(e,t,r,n){return new $n(e,t,r,n)},Jn=function(e,t,r){return new wt(e,t,r,"$size")},zn=function(){return null},Kn=function(e,t,r){var n;if(dn(e))n=e;else if(!process.env.CSP_ENABLED)n=new Function("obj","return "+e);else throw new Error('In CSP mode, sift does not support strings in "$where" condition');return new U(function(s){return n.bind(s)(s)},t,r)},Hn=Object.freeze({__proto__:null,$Size:wt,$eq:jn,$ne:kn,$or:En,$nor:qn,$elemMatch:An,$nin:Fn,$in:Cn,$lt:Tn,$lte:Ln,$gt:Bn,$gte:Mn,$mod:Rn,$exists:Nn,$regex:Qn,$not:Wn,$type:Gn,$and:Vn,$all:Un,$size:Jn,$options:zn,$where:Kn}),Yn=function(e,t,r){var n=r===void 0?{}:r,s=n.compare,i=n.operations;return ie(e,t,{compare:s,operations:Object.assign({},Hn,i||{})})},Xn=function(e,t){t===void 0&&(t={});var r=Yn(e,null,t);return mn(r)};function Ve(e,t,r="g"){const n=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];return t=t.replace(new RegExp(`(\\${n.join("|\\")})`,r),"\\$1"),t=t.replace(/%/g,".*").replace(/_/g,"."),RegExp(`^${t}$`,r).test(e)}function kt(e,t){return Ve(e,t,"ig")}function Zn(e,t,r){return Ie(n=>Ve(n,e),t,r)}function Et(e,t,r){return Ie(n=>!Ve(n,e),t,r)}function qt(e,t,r){return Ie(n=>kt(n,e),t,r)}function xn(e,t,r){return Ie(n=>!kt(n,e),t,r)}const Dn={$like:Zn,$notLike:Et,$notlike:Et,$ilike:qt,$iLike:qt,$notILike:xn},es=["$sort","$limit","$skip","$select"],ts=["$in","$nin","$exists","eq","ne","$mod","$all","$not","$size","$type","$regex","$options","$where","$elemMatch"];function Ue(e){const{idField:t,itemStorage:r,tempStorage:n,cloneStorage:s,addItemToStorage:i,paramsForServer:o=[],whitelist:c=[],customSiftOperators:u={}}=e,a=Object.assign({},Dn,u),f=l.computed(()=>ts.concat(c||[]).concat(Object.keys(a))),p=(m,w=[])=>{m={...l.unref(m)};const y=o,S=ee._.omit(m.query||{},...y),{query:_,filters:j}=de.filterQuery(S,{operators:f.value});let E=w.concat(r.list.value);return n&&m.temps&&E.push(...n.list.value),j.$or&&(_.$or=j.$or),j.$and&&(_.$and=j.$and),E=E.filter(Xn(_,{operations:a})),{values:E,filters:j}};function I(m){const w=l.computed(()=>{const y=l.unref(m);y.query&&(y.query=W(y.query));const S=p(y),_=S.filters;let j=S.values;const E=j.length;return _.$sort&&j.sort(de.sorter(_.$sort)),_.$skip&&(j=j.slice(_.$skip)),typeof _.$limit<"u"&&(j=j.slice(0,_.$limit)),{total:E,limit:_.$limit||0,skip:_.$skip||0,data:y.clones?j.map(A=>A.clone?A.clone(void 0,{useExisting:!0}):A):j}});return l.reactive({total:l.computed(()=>w.value.total),limit:l.computed(()=>w.value.limit),skip:l.computed(()=>w.value.skip),data:l.computed(()=>w.value.data)})}function d(m){const w=I(m);return l.computed(()=>w.data[0]||null)}function O(m){return l.computed(()=>{if(m={...l.unref(m)},!m.query)throw new Error("params must contain a query object");return m.query=ee._.omit(m.query,...es),I(m).total})}const g=(m,w)=>l.computed(()=>{const y=l.unref(m);w=Z(l.unref(w)||{}),w.query&&(w.query=W(w.query));let S=null;const _=r.getItem(y)&&de.select(w,t)(r.getItem(y)),j=n&&n.getItem(y)&&de.select(w,"__tempId")(n.getItem(y));return _?S=_:j&&(S=j),w.clones&&S.clone?S.clone(void 0,{useExisting:!0}):S||null});function $(m){const{items:w,isArray:y}=z(l.unref(m)),S=w.map(_=>i(l.unref(_)));return y?S:S[0]}function b(m,w={},y={}){const S=l.unref(m),_=l.unref(w),j=l.unref(y);function E(A){return A.map(F=>{if(F=l.unref(F),(typeof F=="number"||typeof F=="string")&&(F=g(F).value),F==null)return null;const B={...F,..._};return i(B)}).filter(F=>F)}if(S===null){if(j!=null&&j.query&&!Object.keys(j==null?void 0:j.query).length)throw new Error('cannot perform multiple patchInStore with an empty query. You must explicitly provide a query. To patch all items, try using a query that matches all items, like "{ id: { $exists: true } }"');const A=I(j).data;return E(A)}else{const{items:A,isArray:R}=z(S),F=E(A);return R?F:F[0]}}function v(m,w){if(m===null&&(w!=null&&w.query)&&Object.keys(w==null?void 0:w.query).length){const y=s?s.list.value:[],{values:S}=p(w,y);return P(S)}else m!==null&&P(m);return m}function P(m){const{items:w}=z(m);return w.forEach(y=>{if(typeof y=="string")r.removeItem(y),n==null||n.removeItem(y),s==null||s.removeItem(y);else{if(y.__isClone)return s==null?void 0:s.remove(y);if(y.__isTemp)return n==null?void 0:n.remove(y);r.remove(y),n==null||n.remove(y),s==null||s.remove(y)}}),m}return{findInStore:I,findOneInStore:d,countInStore:O,getFromStore:g,createInStore:$,patchInStore:b,removeFromStore:v}}function be({getId:e,onRead:t=s=>s,beforeWrite:r=s=>s,assign:n=(s,i)=>Object.assign(s,i)}){const s=l.ref({}),i=l.computed(()=>Object.values(s.value)),o=l.computed(()=>Object.keys(s.value)),c=v=>!!s.value[v],u=v=>{const P=e(v);return c(P)},a=v=>{const P=s.value[v];return P?t(P):null},f=(v,P)=>{if(v==null)throw new Error("item has no id");return l.set(s.value,v,r(P)),a(v)},p=v=>{const P=e(v);return f(P,v)},I=v=>{const P=e(v),m=a(P);return m?n(m,v):f(P,v),a(P)},d=v=>{const P=e(v);return a(P)},O=v=>{const P=c(v);return P&&l.del(s.value,v),P};return{byId:s,list:i,ids:o,getId:e,clear:()=>{Object.keys(s.value).forEach(v=>{l.del(s.value,v)})},has:u,hasItem:c,get:d,getItem:a,set:p,setItem:f,remove:v=>{const P=e(v);return O(P)},removeItem:O,getKeys:()=>o.value,merge:I}}function At(e){const{getId:t,itemStorage:r,onRead:n,beforeWrite:s}=e,i=be({getId:t,onRead:n,beforeWrite:s});function o(c){return i.has(c)&&i.remove(c),r.set(c)}return{tempStorage:i,moveTempToItems:o}}function Ft(e){const{itemStorage:t,tempStorage:r,onRead:n,beforeWrite:s}=e,i=(d,O={},{isClone:g})=>Z(Object.assign({},d,O,{__isClone:g})),o=e.makeCopy||i,c=be({getId:d=>{const O=t.getId(d);return O??r.getId(d)},onRead:n,beforeWrite:s});function u(d){return d.__isClone||(t.has(d)?t.merge(d):r.has(d)&&r.merge(d)),t.get(d)||r.get(d)||(t.getId(d)!=null?t.merge(d):r.getId(d)!=null&&r.merge(d)),t.get(d)||r.get(d)}function a(d,O={},g={}){const $=c.get(d);return u(d),$&&g.useExisting?$:p(d,O)}function f(d,O={}){const g=t.getId(d),$=o(d,O,{isClone:!1});return g?(t.merge($),t.get($)):(r.merge($),r.get($))}function p(d,O={}){const g=u(d);if(c.get(d)){const b=o(g,O,{isClone:!0});Object.keys(g).forEach(v=>{g[v]==null&&l.del(b,v)}),c.merge(b)}else{const b=o(d,O,{isClone:!0});c.set(b)}return c.get(d)}function I(d){return Object.defineProperty(d,"__isClone",{writable:!1,enumerable:!1,value:!0}),d}return{cloneStorage:c,clone:a,commit:f,reset:p,markAsClone:I}}function Je(e){const{getIdField:t,setupInstance:r}=e,n=(d,O={},{isClone:g})=>{const $=Z(d);return Object.assign($,O),Object.defineProperty($,"__isTemp",{configurable:!0,enumerable:!1,get(){return this[this.__idField]==null}}),te($,{__isClone:g,__tempId:d.__tempId})},s=be({getId:t,beforeWrite:r,onRead:r}),{tempStorage:i,moveTempToItems:o}=At({getId:d=>d.__tempId,itemStorage:s,beforeWrite:r,onRead:r}),{cloneStorage:c,clone:u,commit:a,reset:f,markAsClone:p}=Ft({itemStorage:s,tempStorage:i,makeCopy:n,beforeWrite:d=>(p(d),r(d)),onRead:r});return{itemStorage:s,tempStorage:i,cloneStorage:c,clone:u,commit:a,reset:f,addItemToStorage:d=>{const O=t(d);return d=r(d),d.__isClone?c.merge(d):O!=null&&d.__tempId!=null?o(d):O!=null?s.merge(d):i&&d.__tempId!=null?i==null?void 0:i.merge(d):s.merge(d)}}}function rs(){return{skipGetIfExists:!1}}function ns(e){const t=Object.assign({},rs(),e),{idField:r,customSiftOperators:n}=t,{itemStorage:s,tempStorage:i,cloneStorage:o,clone:c,commit:u,reset:a,addItemToStorage:f}=Je({getIdField:y=>y[r],setupInstance:v}),{findInStore:p,findOneInStore:I,countInStore:d,getFromStore:O,createInStore:g,patchInStore:$,removeFromStore:b}=Ue({idField:r,itemStorage:s,tempStorage:i,cloneStorage:o,addItemToStorage:f,customSiftOperators:n});function v(y){const S=Le(y,{idField:r,clonesById:o.byId,clone:c,commit:u,reset:a,createInStore:g,removeFromStore:b});if(y.__isSetup)return S;{const _=t.setupInstance?t.setupInstance(S):S;return Object.defineProperty(_,"__isSetup",{value:!0}),_}}const P=l.computed(()=>!!l.unref(t.ssr));function m(){s.clear(),i.clear(),o.clear()}return{new:v,idField:r,isSsr:P,itemsById:s.byId,items:s.list,itemIds:s.ids,tempsById:i.byId,temps:i.list,tempIds:i.ids,clonesById:o.byId,clones:o.list,cloneIds:o.ids,clone:c,commit:u,reset:a,findInStore:p,findOneInStore:I,countInStore:d,createInStore:g,getFromStore:O,patchInStore:$,removeFromStore:b,clearAll:m}}var Ct={},H={};Object.defineProperty(H,"__esModule",{value:!0}),H.createDebug=H.setDebug=H.noopDebug=void 0;const le={};function Tt(){return function(){}}H.noopDebug=Tt;let Lt=Tt;function ss(e){Lt=e,Object.keys(le).forEach(t=>{le[t]=e(t)})}H.setDebug=ss;function os(e){return le[e]||(le[e]=Lt(e)),(...t)=>le[e](...t)}H.createDebug=os,function(e){var t=pe&&pe.__createBinding||(Object.create?function(o,c,u,a){a===void 0&&(a=u);var f=Object.getOwnPropertyDescriptor(c,u);(!f||("get"in f?!c.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return c[u]}}),Object.defineProperty(o,a,f)}:function(o,c,u,a){a===void 0&&(a=u),o[a]=c[u]}),r=pe&&pe.__exportStar||function(o,c){for(var u in o)u!=="default"&&!Object.prototype.hasOwnProperty.call(c,u)&&t(c,o,u)};Object.defineProperty(e,"__esModule",{value:!0}),e.createSymbol=e.isPromise=e._=e.stripSlashes=void 0;function n(o){return o.replace(/^(\/+)|(\/+)$/g,"")}e.stripSlashes=n,e._={each(o,c){o&&typeof o.forEach=="function"?o.forEach(c):e._.isObject(o)&&Object.keys(o).forEach(u=>c(o[u],u))},some(o,c){return Object.keys(o).map(u=>[o[u],u]).some(([u,a])=>c(u,a))},every(o,c){return Object.keys(o).map(u=>[o[u],u]).every(([u,a])=>c(u,a))},keys(o){return Object.keys(o)},values(o){return e._.keys(o).map(c=>o[c])},isMatch(o,c){return e._.keys(c).every(u=>o[u]===c[u])},isEmpty(o){return e._.keys(o).length===0},isObject(o){return typeof o=="object"&&!Array.isArray(o)&&o!==null},isObjectOrArray(o){return typeof o=="object"&&o!==null},extend(o,...c){return Object.assign(o,...c)},omit(o,...c){const u=e._.extend({},o);return c.forEach(a=>delete u[a]),u},pick(o,...c){return c.reduce((u,a)=>(o[a]!==void 0&&(u[a]=o[a]),u),{})},merge(o,c){return e._.isObject(o)&&e._.isObject(c)&&Object.keys(c).forEach(u=>{e._.isObject(c[u])?(o[u]||Object.assign(o,{[u]:{}}),e._.merge(o[u],c[u])):Object.assign(o,{[u]:c[u]})}),o}};function s(o){return e._.isObject(o)&&typeof o.then=="function"}e.isPromise=s;function i(o){return typeof Symbol<"u"?Symbol.for(o):o}e.createSymbol=i,r(H,e)}(Ct);function Bt(e){const{idField:t,isSsr:r}=e,n=e.defaultLimit||10,s=l.ref({});function i(){const{defaultLimit:a,defaultSkip:f}=s.value;s.value={defaultLimit:a,defaultSkip:f}}function o({qid:a,response:f,query:p={},preserveSsr:I=!1}){var R,F;const{data:d,total:O}=f,g=d.map(B=>ae(B,t)),$=new Date().getTime(),{queryId:b,queryParams:v,pageId:P,pageParams:m}=u({qid:a,query:p});s.value[a]||l.set(s.value,a,{}),!V(p,"$limit")&&V(f,"limit")&&l.set(s.value,"defaultLimit",f.limit),!V(p,"$skip")&&V(f,"skip")&&l.set(s.value,"defaultSkip",f.skip);const w={query:p,queryId:b,queryParams:v,pageId:P,pageParams:m,queriedAt:$,total:O},y=(F=(R=s.value[a])==null?void 0:R[b])==null?void 0:F[P],S=s.value[a]||{};Object.assign(S,{mostRecent:w}),l.set(S,b,S[b]||{});const _={total:O,queryParams:v};l.set(S,b,Object.assign({},S[b],_));const j=I?y==null?void 0:y.ssr:r.value,E={[P]:{pageParams:m,ids:g,queriedAt:$,ssr:!!j}};Object.assign(S[b],E);const A=Object.assign({},s.value[a],S);l.set(s.value,a,A)}function c(a){var g,$;const f=u(a),{qid:p,queryId:I,pageId:d}=f,O=($=(g=s.value[p])==null?void 0:g[I])==null?void 0:$[d];O.ssr=!1}function u(a){const f=W(a),{query:p={}}=f,I=f.qid||"default",d=(p==null?void 0:p.$limit)||n,O=(p==null?void 0:p.$skip)||0,g=d!==void 0?{$limit:d,$skip:O}:void 0,$=g?Se(g):void 0,b=Ct._.omit(p,"$limit","$skip"),v=Se(b);return{qid:I,query:p,queryId:v,queryParams:b,pageParams:g,pageId:$,isExpired:!1}}return{pagination:s,updatePaginationForQuery:o,unflagSsr:c,getQueryInfo:u,clearPagination:i}}function Mt(){return{find:0,count:0,get:0,create:0,update:0,patch:0,remove:0}}function Rt(){const e=l.ref(Mt()),t=l.ref({}),r=l.ref({}),n=l.ref({}),s=l.ref({}),i=l.computed(()=>e.value.find>0),o=l.computed(()=>e.value.count>0),c=l.computed(()=>e.value.get>0),u=l.computed(()=>e.value.create>0||Object.keys(t.value).length>0),a=l.computed(()=>e.value.update>0||Object.keys(r.value).length>0),f=l.computed(()=>e.value.patch>0||Object.keys(n.value).length>0),p=l.computed(()=>e.value.remove>0||Object.keys(s.value).length>0);function I($,b){b?e.value[$]++:e.value[$]--}function d($,b,v){if($==null)return;let P;b==="create"?P=t.value:b==="update"?P=r.value:b==="patch"?P=n.value:b==="remove"&&(P=s.value),v?l.set(P,$,!0):l.del(P,$)}function O(...$){$.forEach(b=>{b!=null&&(l.del(t.value,b),l.del(r.value,b),l.del(n.value,b),l.del(s.value,b))})}function g(){e.value=Mt(),t.value={},r.value={},n.value={},s.value={}}return{isPending:e,createPendingById:t,updatePendingById:r,patchPendingById:n,removePendingById:s,isFindPending:i,isCountPending:o,isGetPending:c,isCreatePending:u,isUpdatePending:a,isPatchPending:f,isRemovePending:p,setPending:I,setPendingById:d,unsetPendingById:O,clearAllPending:g}}function Nt(){const e=l.reactive({created:{},patched:{},updated:{},removed:{}});function t(n,s){const{items:i}=z(n);i.forEach(o=>{e[s][o]?r(n,s):(l.set(e[s],o,!0),setTimeout(()=>{r(n,s)},250))})}function r(n,s){const{items:i}=z(n);i.forEach(o=>{l.del(e[s],o)})}return{eventLocks:e,toggleEventLock:t,clearEventLock:r}}function is(){const e=ue.reactive({});function t(i){return e[i]}function r(i,o){e[i]=o}function n(i){delete e[i]}function s(){Object.keys(e).forEach(i=>{n(i)})}return{resultsByQid:e,getQid:t,setQid:r,clearQid:n,clearAllQids:s}}function cs(){return{skipGetIfExists:!1}}function Qt(e){const t=Object.assign({},cs(),e),{idField:r,servicePath:n,whitelist:s,paramsForServer:i,defaultLimit:o,customSiftOperators:c}=t,{itemStorage:u,tempStorage:a,cloneStorage:f,clone:p,commit:I,reset:d,addItemToStorage:O}=Je({getIdField:N=>N[r],setupInstance:y}),{findInStore:g,findOneInStore:$,countInStore:b,getFromStore:v,createInStore:P,patchInStore:m,removeFromStore:w}=Ue({idField:r,itemStorage:u,tempStorage:a,cloneStorage:f,addItemToStorage:O,whitelist:s,paramsForServer:i,customSiftOperators:c});function y(N){const D=Le(N,{idField:r,clonesById:f.byId,clone:p,commit:I,reset:d,createInStore:P,removeFromStore:w});if(N.__isSetup)return D;{const _e=t.setupInstance?t.setupInstance(D):D;return Object.defineProperty(_e,"__isSetup",{value:!0}),_e}}const S=Rt(),_=l.computed(()=>!!l.unref(t.ssr)),{pagination:j,clearPagination:E,updatePaginationForQuery:A,getQueryInfo:R,unflagSsr:F}=Bt({idField:r,isSsr:_,defaultLimit:o}),{resultsByQid:B,getQid:q,setQid:L,clearQid:Y,clearAllQids:x}=is();function we(){u.clear(),a.clear(),f.clear(),E(),S.clearAllPending(),x()}const Ke=Nt();return{new:y,idField:r,servicePath:n,isSsr:_,defaultLimit:o,itemsById:u.byId,items:u.list,itemIds:u.ids,tempsById:a.byId,temps:a.list,tempIds:a.ids,clonesById:f.byId,clones:f.list,cloneIds:f.ids,clone:p,commit:I,reset:d,findInStore:g,findOneInStore:$,countInStore:b,createInStore:P,getFromStore:v,patchInStore:m,removeFromStore:w,clearAll:we,resultsByQid:B,getQid:q,setQid:L,clearQid:Y,clearAllQids:x,whitelist:s,paramsForServer:i,pagination:j,updatePaginationForQuery:A,unflagSsr:F,getQueryInfo:R,...S,...Ke}}const J={};function us(e){return`is${e.slice(0,1).toUpperCase()}${e.slice(1,e.length-1)}Pending`}function as(e){return{promise:null,isResolved:!1,getter:us(e)}}function ls(e,t){return J[t]=J[t]||as(t),(!J[t].promise||J[t].isResolved)&&(J[t].promise=new Promise(r=>{const n=l.watch(()=>e[J[t].getter],async s=>{s||setTimeout(()=>{n(),J[t].isResolved=!0,r(J[t].isResolved)},0)},{immediate:!0})})),J[t].promise}var fs=ds;function ds(e,t,r,n){var s,i,o;return function(){if(o=this,i=Array.prototype.slice.call(arguments),s&&(r||n))return;if(!r)return a(),s=setTimeout(u,t),s;s=setTimeout(a,t),e.apply(o,i);function u(){a(),e.apply(o,i)}function a(){clearTimeout(s),s=null}}}const ze=he(fs);function Wt(e){if(!e.service||e.handleEvents===!1)return;const t=e.service,r=l.ref({}),n=l.ref({}),s=ze(async()=>{const a=Object.values(r.value);a.length!==0&&(t.store.createInStore(a),r.value={})},e.debounceEventsTime||20,void 0,e.debounceEventsGuarantee);function i(a){const f=ae(a,t.store.idField);f&&(l.set(r,f,a),V(n.value,f)&&l.del(n,f),s())}const o=ze(()=>{const a=Object.values(n.value);a.length!==0&&(t.store.removeFromStore(a),n.value={})},e.debounceEventsTime||20,void 0,e.debounceEventsGuarantee);function c(a){const f=ae(a,t.store.idField);f&&(l.set(n,f,a),V(r.value,f)&&l.del(r.value,f),o())}function u(a,f){var d;const p=(d=e.handleEvents)==null?void 0:d[a];if(p===!1)return;const I=ae(f,t.store.idField);if(a!=="created"&&t.store.eventLocks[a][I]){t.store.toggleEventLock(I,a);return}p&&!p(f,{service:t})||(e.debounceEventsTime?a==="removed"?c(f):i(f):a==="removed"?t.store.removeFromStore(f):t.store.createInStore(f))}t.on("created",a=>{const f=re(t,a);u("created",f)}),t.on("updated",a=>{const f=re(t,a);u("updated",f)}),t.on("patched",a=>{const f=re(t,a);u("patched",f)}),t.on("removed",a=>{const f=re(t,a);u("removed",f)})}function ps(){return async(e,t)=>{if(e.params.value&&(e.params=W(e.params)),e.params.query&&(e.params.query=W(e.params.query)),e.method==="find"){const r=e.params.query||{};r.$limit==null&&(r.$limit=e.service.store.defaultLimit),r.$skip==null&&(r.$skip=0),e.params.query=r}t&&await t()}}function Gt(){return async(e,t)=>{var s,i,o;const r=e.service.store;let n;if(!r.isSsr){const c=e.method==="find"?((s=e.params.query)==null?void 0:s.$limit)===0?"count":"find":e.method;r.setPending(c,!0),e.id!=null&&c!=="get"&&r.setPendingById(e.id,c,!0);const u=(i=e.data)==null?void 0:i.__isTemp,a=(o=e.data)==null?void 0:o.__tempId;u&&c==="create"&&r.setPendingById(e.data.__tempId,c,!0),n=()=>{r.setPending(c,!1);const f=e.id!=null?e.id:a;f!=null&&c!=="get"&&r.setPendingById(f,c,!1)}}try{await t()}catch(c){throw n&&n(),c}n&&n()}}function Vt(){return async(e,t)=>{const{id:r,method:n}=e,s=e.service.store,i=["update","patch","remove"].includes(n),c={update:"updated",patch:"patched",remove:"removed"}[n];i&&r&&!s.isSsr&&s.toggleEventLock(r,c),await t(),i&&r&&!s.isSsr&&s.clearEventLock(r,c)}}function Ut(){return async(e,t)=>{const{method:r,params:n}=e,s=e.service.store;if(r==="patch"&&n.data&&(e.data=n.data),t&&await t(),!e.params.skipStore){if(r==="remove")s.removeFromStore(e.result);else if(r==="create"){const i=ut(e.data,e.result);e.result=s.createInStore(i)}else r==="find"&&Array.isArray(e.result.data)?e.result.data=s.createInStore(e.result.data):e.result=s.createInStore(e.result);if(r==="find"&&e.result.total){const{qid:i="default",query:o,preserveSsr:c=!1}=e.params;s.updatePaginationForQuery({qid:i,response:e.result,query:o,preserveSsr:c})}}}}function Jt(){return async(e,t)=>{var r;t&&await t(),e.service.new&&(Array.isArray((r=e.result)==null?void 0:r.data)?e.result.data=e.result.data.map(n=>e.service.new(n)):Array.isArray(e.result)?e.result=e.result.map(n=>e.service.new(n)):e.result=e.service.new(e.result))}}function hs(){return async(e,t)=>{const r=e.service.store;if(e.method==="find"){const{params:n}=e,s=r.getQueryInfo(n),i=r.pagination[s.qid],o=i==null?void 0:i[s.queryId],c=o==null?void 0:o[s.pageId];c!=null&&c.ssr&&(e.result={data:c.ids.map(u=>r.getFromStore(u).value),limit:c.pageParams.$limit,skip:c.pageParams.$skip,total:o.total,fromSsr:!0},n.preserveSsr||r.unflagSsr(n))}t&&await t()}}function zt(){return async(e,t)=>{if(e.method==="find"){const{params:r}=e,{query:n={}}=r;(r.paginate===!0||V(n,"$limit")||V(n,"$skip"))&&(r.paginate={default:!0})}t&&await t()}}function Kt(){return async(e,t)=>{const{params:r,id:n}=e,s=e.service.store;if(e.method==="get"&&n!=null){const i=r.skipGetIfExists||s.skipGetIfExists;delete r.skipGetIfExists;const o=s.getFromStore(e.id,r);o&&i&&(e.result=o)}await t()}}function ys(){return async(e,t)=>{const{method:r,data:n,params:s,id:i}=e,o=e.service.store;let c,u;const a=r==="patch"&&!s.data&&(n.__isClone||s.diff);if(a){u=n;const f=o.getFromStore(i).value,p=Fe(f,u,s.diff);if(c=Z(f),s.eager!==!1&&n.commit(p),s.with){const I=me(u,s.with);typeof s.with!="string"&&!Array.isArray(s.with)&&Object.assign(I,s.with),Object.assign(p,I)}e.data=p,Object.keys(e.data).length===0&&(e.result=u)}else e.data=Z(n);try{await t()}catch(f){throw a&&u&&u.commit(c),f}}}function gs(){return async(e,t)=>{const{params:r}=e,n=e.service.store;if(r.qid){const s=n.getQid(r.qid);if(s!==void 0)return n.isSsr||setTimeout(()=>{n.clearQid(r.qid)},500),e.result=s,await t()}await t(),r.qid&&n.isSsr&&n.setQid(r.qid,e.result)}}function Ht(){return[ps(),Gt(),Vt(),Ut(),Jt(),hs(),zt(),Kt(),ys(),gs()]}function Yt(e,t){if(e.__isServiceInstance)return e;const{service:r,store:n}=t,s=(i,o)=>Object.assign(i,o);return Ae(e,{isPending(){return this.isCreatePending||this.isPatchPending||this.isRemovePending},isSavePending(){return this.isCreatePending||this.isPatchPending},isCreatePending(){return!!(n.createPendingById[this[n.idField]]||n.createPendingById[this.__tempId])},isPatchPending(){return!!n.patchPendingById[this[n.idField]]},isRemovePending(){return!!n.removePendingById[this[n.idField]]}}),te(e,{__isServiceInstance:!0,save(i){return this[n.idField]!=null?this.patch(i):this.create(i)},create(i){return r.create(this,i).then(o=>s(this,o))},patch(i){const o=this[n.idField];if(o===void 0)throw new cr.BadRequest("the item has no id");return r.patch(o,this,i).then(c=>s(this,c))},remove(i){if(this.__isTemp)return n.removeFromStore(this.__tempId),Promise.resolve(this);{const o=this[n.idField];return r.remove(o,i).then(c=>s(this,c))}}}),e}function Xt(e,t){const r={};Object.keys(t).forEach(n=>{const s=e[n],i=t[n],o=this.service(i);if(o||console.error(`there is no service at path ${i}. Check your storeAssociated config`,e,t),s&&o){const c=o.createInStore(s);r[n]=c}}),te(e,r)}function Zt(e,t,r){const n=JSON.stringify(t);r.setItem(e,n)}function xt(e,t){const r=t.getItem(e.$id);if(r){const n=JSON.parse(r)||{};Object.assign(e,n)}}function Dt(e,t,r=window.localStorage){xt(e,r);const n=ze(Zt,500),s=l.computed(()=>ee._.pick(e,...t));l.watch(s,i=>n(e.$id,i,r),{deep:!0})}function er(e=window.localStorage){const t="service:";for(let r=0;r<e.length;r++){const n=e.key(r);n!=null&&n.startsWith(t)&&e.removeItem(n)}}function vs(e,t){const r=M.feathers();r.defaultService=function(s){var w;const i=((w=t.services)==null?void 0:w[s])||{},o=i.idField||t.idField,c=i.defaultLimit||t.defaultLimit||10,u=(i.whitelist||[]).concat(t.whitelist||[]),a=(i.paramsForServer||[]).concat(t.paramsForServer||[]),f=i.handleEvents||t.handleEvents,p=i.debounceEventsTime!=null?i.debounceEventsTime:t.debounceEventsTime,I=i.debounceEventsGuarantee!=null?i.debounceEventsGuarantee:t.debounceEventsGuarantee,d=Object.assign({},i.customSiftOperators||{},t.customSiftOperators||{});function O(y){const S=Object.assign(y,t.customizeStore?t.customizeStore(y):y);return Object.assign(S,i.customizeStore?i.customizeStore(S):S)}function g(y){const S=i.instanceServicePath||s,_=r.service(S),j=Yt(y,{service:_,store:v}),E={app:r,service:_,servicePath:S},A=t.setupInstance?t.setupInstance(j,E):j;return i.setupInstance?i.setupInstance(A,E):A}const $=i.storeName||`service:${s}`,b=t.pinia._s.get($);let v;if(b?v=b:v=X.defineStore($,()=>{const S=Qt({idField:o,servicePath:s,defaultLimit:c,whitelist:u,paramsForServer:a,customSiftOperators:d,ssr:t.ssr,setupInstance:g}),_=O(S);return{...S,..._}})(t.pinia),!t.ssr&&t.storage){const y=["itemsById","pagination"],S=t.syncWithStorage===!0?y:Array.isArray(t.syncWithStorage)?t.syncWithStorage:[],_=i.syncWithStorage===!0?y:Array.isArray(i.syncWithStorage)?i.syncWithStorage:[],j=[...new Set([...S,..._])];j.length>0&&Dt(v,j,t.storage)}const P=e.service(s),m=new vt(P,{store:v,servicePath:s});return Wt({service:m,debounceEventsTime:p,debounceEventsGuarantee:I,handleEvents:f}),m};const n=s=>{s.hooks({around:Ht()})};return r.mixins.push(n),Ae(r,{authentication(){return e.authentication},authenticate(){return e.authenticate},reAuthenticate(){return e.reAuthenticate},logout(){return e.logout},clearStorage(){if(!t.ssr&&t.storage)return er(t.storage)}}),Object.assign(r,{storeAssociated:Xt,pushToStore(s,i){const o=r.service(i);return ft(s,o)},defineVirtualProperty:Te,defineVirtualProperties:dt}),r}class ms extends ur.FetchClient{async request(t,r){const n=Object.assign({},t,r.connection);n.headers=Object.assign({Accept:"application/json"},this.options.headers,n.headers),t.body&&(n.body=t.body);try{const s=await this.connection.raw(t.url,n),{_data:i,status:o}=s;return o===204?null:i}catch(s){throw s.data}}}const Ss={"feathers-pinia":["useServiceInstance","useInstanceDefaults","useDataStore","useAuth","createPiniaClient","defineGetters","defineSetters","defineValues","useBackup"]};class fe extends Error{}fe.prototype.name="InvalidTokenError";function Is(e){return decodeURIComponent(atob(e).replace(/(.)/g,(t,r)=>{let n=r.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}function Os(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return Is(t)}catch{return atob(t)}}function bs(e,t){if(typeof e!="string")throw new fe("Invalid token specified: must be a string");t||(t={});const r=t.header===!0?0:1,n=e.split(".")[r];if(typeof n!="string")throw new fe(`Invalid token specified: missing part #${r+1}`);let s;try{s=Os(n)}catch(i){throw new fe(`Invalid token specified: invalid base64 for part #${r+1} (${i.message})`)}try{return JSON.parse(s)}catch(i){throw new fe(`Invalid token specified: invalid json for part #${r+1} (${i.message})`)}}function ws(e){const{api:t,servicePath:r,skipTokenCheck:n}=e,s=r?t.service(r):null,i=e.entityKey||"user",o=l.ref(),c=async()=>{},u=async q=>{throw q},a=e.onSuccess||c,f=e.onError||u,p=e.onInitSuccess||c,I=e.onInitError||c,d=e.onLogoutSuccess||c,O=e.onLogoutError||u,g=l.ref(null),$=l.computed(()=>!s||!g.value?null:(s==null?void 0:s.store.itemsById[g.value])||null),b=l.ref(null),v=()=>b.value=null,P=at(),m=l.computed(()=>!!P.count.value),w=l.ref(!1),y=q=>{const L=q[i];if(s&&L){const Y=s.store.createInStore(L);g.value=Y[s.store.idField]||Y.__tempId}return w.value=!0,q},S=async q=>(P.add(),v(),o.value=t.authenticate(q).then(y).then(async L=>await a(L)||L).catch(L=>(b.value=L,f(L))).finally(()=>{P.sub()}),o.value),_=q=>{try{const L=bs(q);return new Date().getTime()>L.exp*1e3}catch{return!1}},j=l.ref(!1),E=async()=>(P.add(),o.value=t.reAuthenticate().then(y).then(async q=>await p(q)||q).catch(q=>(q.value=q,I(q))).finally(()=>{P.sub(),j.value=!0}),o.value),A=at(),R=l.computed(()=>!!A.count.value),F=async()=>(A.add(),t.logout().then(q=>(g.value=null,w.value=!1,q)).then(d).catch(q=>(q.value=q,O(q))).finally(()=>A.sub())),B=l.ref(null);return{userId:g,user:$,error:b,isPending:m,isLogoutPending:R,isInitDone:j,isAuthenticated:w,loginRedirect:B,getPromise:()=>o.value,isTokenExpired:_,authenticate:S,reAuthenticate:E,logout:F,clearError:v}}function _s(e,t){const r=ue.ref(null);ue.watch(e,async i=>{var a,f;if(!e)return;const o=t==null?void 0:t.idField,c=o?i==null?void 0:i[o]:i==null?void 0:i.id,u=o?(a=r.value)==null?void 0:a[o]:(f=r.value)==null?void 0:f.id;c!==u&&(r.value=ct(i))},{immediate:!0});async function n(){const i=ue.unref(e),o=Fe(r.value,i,t==null?void 0:t.onlyProps);if(Object.keys(o).length)try{const c=await e.value.save({data:o});r.value=ct(c)}catch(c){throw console.error("could not save",c),c}else return i}function s(i){if(r.value){const o=ue.isRef(i)?i.value:i;Object.assign(o,r.value)}return i}return{data:e,backup:r,save:n,restore:s}}h.OFetch=ms,h.PiniaService=vt,h.clearStorage=er,h.createPiniaClient=vs,h.defineGetters=Ae,h.defineSetters=Vr,h.defineValues=te,h.defineVirtualProperties=dt,h.defineVirtualProperty=Te,h.diff=Fe,h.eventLocks=Vt,h.feathersPiniaAutoImport=Ss,h.feathersPiniaHooks=Ht,h.getArray=z,h.getExtendedQueryInfo=ve,h.getId=ae,h.getParams=K,h.hasOwn=V,h.hydrateStore=xt,h.makeModelInstances=Jt,h.normalizeFind=zt,h.pickDiff=me,h.pushToStore=ft,h.restoreTempIds=ut,h.setPending=Gt,h.skipGetIfExists=Kt,h.storeAssociated=Xt,h.syncStore=Ut,h.syncWithStorage=Dt,h.timeout=ne,h.useAllStorageTypes=Je,h.useAuth=ws,h.useBackup=_s,h.useDataStore=ns,h.useFind=yt,h.useGet=gt,h.useInstanceDefaults=Hr,h.useModelInstance=Le,h.useQueuePromise=ls,h.useServiceClones=Ft,h.useServiceEventLocks=Nt,h.useServiceEvents=Wt,h.useServiceInstance=Yt,h.useServiceLocal=Ue,h.useServicePagination=Bt,h.useServicePending=Rt,h.useServiceStorage=be,h.useServiceStore=Qt,h.useServiceTemps=At,h.writeToStorage=Zt,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=feathers-pinia.umd.cjs.map
